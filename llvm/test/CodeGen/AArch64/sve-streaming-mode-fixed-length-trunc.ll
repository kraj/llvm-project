; NOTE: Assertions have been autogenerated by utils/update_llc_test_checks.py
; RUN: llc -mattr=+sve2 -force-streaming-compatible < %s | FileCheck %s
; RUN: llc -mattr=+sme -force-streaming < %s | FileCheck %s
; RUN: llc -force-streaming-compatible < %s | FileCheck %s --check-prefix=NONEON-NOSVE


target triple = "aarch64-unknown-linux-gnu"

;
; truncate i16 -> i8
;

define <16 x i8> @trunc_v16i16_v16i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v16i16_v16i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z3.b, z0.b, z0.b
; CHECK-NEXT:    uzp1 z2.b, z1.b, z1.b
; CHECK-NEXT:    splice z0.b, p0, { z2.b, z3.b }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i16_v16i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #-48]!
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #30]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #47]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #28]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #46]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #26]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #45]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #24]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #44]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #22]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #43]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #20]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #42]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #18]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #41]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #16]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #40]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #14]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #39]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #12]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #38]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #10]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #37]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #8]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #36]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #6]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #35]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #4]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #34]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #2]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #33]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i16>, ptr %in
  %b = trunc <16 x i16> %a to <16 x i8>
  ret <16 x i8> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i16_v32i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i16_v32i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.b, z0.b, z0.b
; CHECK-NEXT:    uzp1 z4.b, z1.b, z1.b
; CHECK-NEXT:    uzp1 z1.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z0.b, z3.b, z3.b
; CHECK-NEXT:    splice z2.b, p0, { z4.b, z5.b }
; CHECK-NEXT:    splice z0.b, p0, { z0.b, z1.b }
; CHECK-NEXT:    add z1.b, z2.b, z2.b
; CHECK-NEXT:    add z0.b, z0.b, z0.b
; CHECK-NEXT:    stp q0, q1, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i16_v32i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #208
; NONEON-NOSVE-NEXT:    ldp q0, q1, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #112] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #128] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #144] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #160] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp q2, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #32]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #34]
; NONEON-NOSVE-NEXT:    ldrh w29, [sp, #20]
; NONEON-NOSVE-NEXT:    stp q3, q1, [sp, #80]
; NONEON-NOSVE-NEXT:    ldrh w27, [sp, #16]
; NONEON-NOSVE-NEXT:    ldrh w28, [sp, #18]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #8] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #24]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #22]
; NONEON-NOSVE-NEXT:    ldrh w25, [sp, #92]
; NONEON-NOSVE-NEXT:    ldrh w26, [sp, #94]
; NONEON-NOSVE-NEXT:    ldrh w23, [sp, #88]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    ldrh w24, [sp, #90]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #60]
; NONEON-NOSVE-NEXT:    add w8, w29, w29
; NONEON-NOSVE-NEXT:    ldrh w4, [sp, #108]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #59]
; NONEON-NOSVE-NEXT:    add w9, w28, w28
; NONEON-NOSVE-NEXT:    ldrh w7, [sp, #110]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #58]
; NONEON-NOSVE-NEXT:    add w8, w27, w27
; NONEON-NOSVE-NEXT:    ldrh w2, [sp, #104]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #176] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w21, [sp, #84]
; NONEON-NOSVE-NEXT:    ldrh w22, [sp, #86]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #57]
; NONEON-NOSVE-NEXT:    add w9, w26, w26
; NONEON-NOSVE-NEXT:    ldrh w3, [sp, #106]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #56]
; NONEON-NOSVE-NEXT:    add w8, w25, w25
; NONEON-NOSVE-NEXT:    ldrh w18, [sp, #100]
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #192] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w19, [sp, #80]
; NONEON-NOSVE-NEXT:    ldrh w20, [sp, #82]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #55]
; NONEON-NOSVE-NEXT:    add w9, w24, w24
; NONEON-NOSVE-NEXT:    ldrh w0, [sp, #102]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #54]
; NONEON-NOSVE-NEXT:    add w8, w23, w23
; NONEON-NOSVE-NEXT:    ldrh w12, [sp, #28]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #53]
; NONEON-NOSVE-NEXT:    add w9, w22, w22
; NONEON-NOSVE-NEXT:    ldrh w13, [sp, #30]
; NONEON-NOSVE-NEXT:    add w6, w12, w12
; NONEON-NOSVE-NEXT:    strb w8, [sp, #52]
; NONEON-NOSVE-NEXT:    add w8, w21, w21
; NONEON-NOSVE-NEXT:    add w5, w13, w13
; NONEON-NOSVE-NEXT:    strb w9, [sp, #51]
; NONEON-NOSVE-NEXT:    add w9, w20, w20
; NONEON-NOSVE-NEXT:    strb w8, [sp, #50]
; NONEON-NOSVE-NEXT:    add w8, w19, w19
; NONEON-NOSVE-NEXT:    ldrh w16, [sp, #96]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #49]
; NONEON-NOSVE-NEXT:    add w9, w7, w7
; NONEON-NOSVE-NEXT:    ldrh w17, [sp, #98]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #48]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    ldrh w14, [sp, #44]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #79]
; NONEON-NOSVE-NEXT:    add w9, w3, w3
; NONEON-NOSVE-NEXT:    ldrh w15, [sp, #46]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #78]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    ldrh w12, [sp, #40]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #77]
; NONEON-NOSVE-NEXT:    add w9, w0, w0
; NONEON-NOSVE-NEXT:    ldrh w13, [sp, #42]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #76]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    ldrh w10, [sp, #36]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #75]
; NONEON-NOSVE-NEXT:    add w9, w17, w17
; NONEON-NOSVE-NEXT:    ldrh w11, [sp, #38]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #74]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    ldrh w30, [sp, #26]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #73]
; NONEON-NOSVE-NEXT:    add w9, w15, w15
; NONEON-NOSVE-NEXT:    strb w8, [sp, #72]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strb w9, [sp, #71]
; NONEON-NOSVE-NEXT:    add w9, w13, w13
; NONEON-NOSVE-NEXT:    strb w8, [sp, #70]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strb w9, [sp, #69]
; NONEON-NOSVE-NEXT:    add w9, w11, w11
; NONEON-NOSVE-NEXT:    strb w8, [sp, #68]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strb w9, [sp, #67]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #8] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #66]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #12] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w5, [sp, #63]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w6, [sp, #62]
; NONEON-NOSVE-NEXT:    strb w5, [sp, #61]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #192] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w9, [sp, #65]
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #176] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #64]
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #160] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #48]
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #144] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #128] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #112] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    add sp, sp, #208
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i16>, ptr %in
  %b = trunc <32 x i16> %a to <32 x i8>
  %c = add <32 x i8> %b, %b
  store <32 x i8> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v64i16_v64i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v64i16_v64i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #64]
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    ldp q2, q3, [x0, #96]
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    uzp1 z7.b, z0.b, z0.b
; CHECK-NEXT:    uzp1 z6.b, z1.b, z1.b
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    uzp1 z17.b, z3.b, z3.b
; CHECK-NEXT:    uzp1 z16.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z3.b, z5.b, z5.b
; CHECK-NEXT:    uzp1 z2.b, z4.b, z4.b
; CHECK-NEXT:    uzp1 z5.b, z0.b, z0.b
; CHECK-NEXT:    splice z0.b, p0, { z6.b, z7.b }
; CHECK-NEXT:    uzp1 z4.b, z1.b, z1.b
; CHECK-NEXT:    splice z1.b, p0, { z16.b, z17.b }
; CHECK-NEXT:    splice z2.b, p0, { z2.b, z3.b }
; CHECK-NEXT:    splice z3.b, p0, { z4.b, z5.b }
; CHECK-NEXT:    add z0.b, z0.b, z0.b
; CHECK-NEXT:    add z1.b, z1.b, z1.b
; CHECK-NEXT:    add z2.b, z2.b, z2.b
; CHECK-NEXT:    add z3.b, z3.b, z3.b
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v64i16_v64i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #448
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #416] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #64]
; NONEON-NOSVE-NEXT:    str x1, [sp, #344] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #432] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0]
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #400] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #96]
; NONEON-NOSVE-NEXT:    str q2, [sp, #192]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #206]
; NONEON-NOSVE-NEXT:    stp q0, q1, [sp, #128]
; NONEON-NOSVE-NEXT:    ldrh w10, [sp, #200]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #144]
; NONEON-NOSVE-NEXT:    stp q7, q6, [sp, #160]
; NONEON-NOSVE-NEXT:    ldrh w11, [sp, #198]
; NONEON-NOSVE-NEXT:    add w21, w8, w8
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #146]
; NONEON-NOSVE-NEXT:    str q5, [sp, #224]
; NONEON-NOSVE-NEXT:    ldrh w12, [sp, #196]
; NONEON-NOSVE-NEXT:    ldrh w13, [sp, #194]
; NONEON-NOSVE-NEXT:    stp q4, q3, [sp, #288]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #56] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #148]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #150]
; NONEON-NOSVE-NEXT:    ldrh w14, [sp, #192]
; NONEON-NOSVE-NEXT:    ldrh w15, [sp, #318]
; NONEON-NOSVE-NEXT:    ldrh w16, [sp, #316]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #24] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #152]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #154]
; NONEON-NOSVE-NEXT:    ldrh w17, [sp, #314]
; NONEON-NOSVE-NEXT:    ldrh w18, [sp, #312]
; NONEON-NOSVE-NEXT:    ldrh w0, [sp, #310]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #80] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #156]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #158]
; NONEON-NOSVE-NEXT:    ldrh w1, [sp, #308]
; NONEON-NOSVE-NEXT:    ldrh w2, [sp, #306]
; NONEON-NOSVE-NEXT:    ldrh w3, [sp, #304]
; NONEON-NOSVE-NEXT:    str w8, [sp, #340] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #128]
; NONEON-NOSVE-NEXT:    ldrh w4, [sp, #302]
; NONEON-NOSVE-NEXT:    ldrh w5, [sp, #300]
; NONEON-NOSVE-NEXT:    ldrh w6, [sp, #298]
; NONEON-NOSVE-NEXT:    ldrh w7, [sp, #296]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #88] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #130]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #132]
; NONEON-NOSVE-NEXT:    ldrh w19, [sp, #294]
; NONEON-NOSVE-NEXT:    ldrh w20, [sp, #292]
; NONEON-NOSVE-NEXT:    ldrh w22, [sp, #290]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #16] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #134]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #136]
; NONEON-NOSVE-NEXT:    ldrh w23, [sp, #288]
; NONEON-NOSVE-NEXT:    ldrh w24, [sp, #238]
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #384] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #112] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #138]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #140]
; NONEON-NOSVE-NEXT:    ldrh w25, [sp, #236]
; NONEON-NOSVE-NEXT:    ldrh w26, [sp, #234]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #368] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    str w8, [sp, #336] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #142]
; NONEON-NOSVE-NEXT:    ldrh w27, [sp, #232]
; NONEON-NOSVE-NEXT:    ldrh w28, [sp, #230]
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #352] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w29, [sp, #228]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #96] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #160]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #162]
; NONEON-NOSVE-NEXT:    ldrh w30, [sp, #226]
; NONEON-NOSVE-NEXT:    strb w21, [sp, #287]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #164]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #166]
; NONEON-NOSVE-NEXT:    str w8, [sp, #332] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #168]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #120] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #170]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #172]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #72] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #174]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #176]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #32] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #178]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #180]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #8] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #182]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #184]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #104] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #186]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #188]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #64] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #190]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #224]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #48] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #202]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #204]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strb w8, [sp, #285]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strb w8, [sp, #284]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strb w8, [sp, #283]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strb w8, [sp, #282]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strb w8, [sp, #281]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strb w8, [sp, #280]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strb w8, [sp, #279]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    strb w8, [sp, #278]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strb w8, [sp, #277]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    strb w8, [sp, #276]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strb w8, [sp, #275]
; NONEON-NOSVE-NEXT:    add w8, w1, w1
; NONEON-NOSVE-NEXT:    strb w8, [sp, #274]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    strb w8, [sp, #273]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strb w8, [sp, #272]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    strb w8, [sp, #271]
; NONEON-NOSVE-NEXT:    add w8, w5, w5
; NONEON-NOSVE-NEXT:    strb w8, [sp, #270]
; NONEON-NOSVE-NEXT:    add w8, w6, w6
; NONEON-NOSVE-NEXT:    strb w8, [sp, #269]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strb w8, [sp, #268]
; NONEON-NOSVE-NEXT:    add w8, w19, w19
; NONEON-NOSVE-NEXT:    strb w8, [sp, #267]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    strb w8, [sp, #266]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    strb w8, [sp, #265]
; NONEON-NOSVE-NEXT:    add w8, w23, w23
; NONEON-NOSVE-NEXT:    strb w8, [sp, #264]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strb w8, [sp, #263]
; NONEON-NOSVE-NEXT:    add w8, w25, w25
; NONEON-NOSVE-NEXT:    strb w8, [sp, #262]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strb w8, [sp, #261]
; NONEON-NOSVE-NEXT:    add w8, w27, w27
; NONEON-NOSVE-NEXT:    strb w8, [sp, #260]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strb w8, [sp, #259]
; NONEON-NOSVE-NEXT:    add w8, w29, w29
; NONEON-NOSVE-NEXT:    strb w8, [sp, #258]
; NONEON-NOSVE-NEXT:    add w8, w30, w30
; NONEON-NOSVE-NEXT:    strb w8, [sp, #257]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #48] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w9, [sp, #286]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #432] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldr q2, [sp, #272]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #256]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #52] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #416] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #400] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #223]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #64] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #384] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #368] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #222]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #68] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #352] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #221]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #104] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #220]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #108] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #219]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #8] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #218]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #12] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #217]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #216]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #36] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #215]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #72] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #214]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #76] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #213]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #120] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #212]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #124] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #211]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #332] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #210]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #209]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #208]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #96] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldr q1, [sp, #208]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #255]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #100] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #254]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #336] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #253]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #112] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #252]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #116] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #251]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #16] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #250]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #20] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #249]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #248]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #92] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #247]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #340] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #246]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #80] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #245]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #84] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #244]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #24] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #243]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #28] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #242]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #56] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #241]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #60] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #240]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #344] // 8-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q0, q3, [sp, #240]
; NONEON-NOSVE-NEXT:    stp q3, q2, [x8]
; NONEON-NOSVE-NEXT:    stp q0, q1, [x8, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #448
; NONEON-NOSVE-NEXT:    ret
  %a = load <64 x i16>, ptr %in
  %b = trunc <64 x i16> %a to <64 x i8>
  %c = add <64 x i8> %b, %b
  store <64 x i8> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v128i16_v128i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v128i16_v128i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q2, q3, [x0, #192]
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    ldp q6, q7, [x0, #64]
; CHECK-NEXT:    uzp1 z17.b, z3.b, z3.b
; CHECK-NEXT:    ldp q3, q18, [x0, #224]
; CHECK-NEXT:    uzp1 z16.b, z2.b, z2.b
; CHECK-NEXT:    ldp q2, q19, [x0, #128]
; CHECK-NEXT:    ldp q0, q1, [x0, #32]
; CHECK-NEXT:    uzp1 z21.b, z18.b, z18.b
; CHECK-NEXT:    ldp q18, q22, [x0, #160]
; CHECK-NEXT:    uzp1 z20.b, z3.b, z3.b
; CHECK-NEXT:    uzp1 z24.b, z19.b, z19.b
; CHECK-NEXT:    ldp q3, q19, [x0, #96]
; CHECK-NEXT:    uzp1 z23.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z26.b, z22.b, z22.b
; CHECK-NEXT:    splice z2.b, p0, { z16.b, z17.b }
; CHECK-NEXT:    uzp1 z17.b, z7.b, z7.b
; CHECK-NEXT:    uzp1 z25.b, z18.b, z18.b
; CHECK-NEXT:    splice z7.b, p0, { z20.b, z21.b }
; CHECK-NEXT:    uzp1 z21.b, z5.b, z5.b
; CHECK-NEXT:    uzp1 z19.b, z19.b, z19.b
; CHECK-NEXT:    uzp1 z20.b, z4.b, z4.b
; CHECK-NEXT:    uzp1 z5.b, z1.b, z1.b
; CHECK-NEXT:    uzp1 z16.b, z6.b, z6.b
; CHECK-NEXT:    splice z6.b, p0, { z23.b, z24.b }
; CHECK-NEXT:    uzp1 z18.b, z3.b, z3.b
; CHECK-NEXT:    splice z3.b, p0, { z25.b, z26.b }
; CHECK-NEXT:    uzp1 z4.b, z0.b, z0.b
; CHECK-NEXT:    add z0.b, z2.b, z2.b
; CHECK-NEXT:    add z7.b, z7.b, z7.b
; CHECK-NEXT:    splice z1.b, p0, { z16.b, z17.b }
; CHECK-NEXT:    splice z2.b, p0, { z18.b, z19.b }
; CHECK-NEXT:    splice z16.b, p0, { z20.b, z21.b }
; CHECK-NEXT:    splice z4.b, p0, { z4.b, z5.b }
; CHECK-NEXT:    add z6.b, z6.b, z6.b
; CHECK-NEXT:    add z3.b, z3.b, z3.b
; CHECK-NEXT:    stp q0, q7, [x1, #96]
; CHECK-NEXT:    add z0.b, z1.b, z1.b
; CHECK-NEXT:    add z1.b, z2.b, z2.b
; CHECK-NEXT:    add z2.b, z16.b, z16.b
; CHECK-NEXT:    stp q6, q3, [x1, #64]
; CHECK-NEXT:    add z3.b, z4.b, z4.b
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v128i16_v128i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #-96]! // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #16] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #32] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #48] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #64] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #80] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    sub sp, sp, #800
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    str x1, [sp, #792] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #96]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #192]
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #160]
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #128]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #224]
; NONEON-NOSVE-NEXT:    stp q4, q0, [sp, #512]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #542]
; NONEON-NOSVE-NEXT:    stp q18, q5, [sp, #480]
; NONEON-NOSVE-NEXT:    ldrh w10, [sp, #536]
; NONEON-NOSVE-NEXT:    stp q17, q20, [sp, #336]
; NONEON-NOSVE-NEXT:    ldrh w11, [sp, #534]
; NONEON-NOSVE-NEXT:    ldrh w12, [sp, #532]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #336]
; NONEON-NOSVE-NEXT:    stp q7, q21, [sp, #368]
; NONEON-NOSVE-NEXT:    str w8, [sp, #736] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #338]
; NONEON-NOSVE-NEXT:    ldrh w13, [sp, #530]
; NONEON-NOSVE-NEXT:    stp q16, q23, [sp, #416]
; NONEON-NOSVE-NEXT:    ldrh w14, [sp, #528]
; NONEON-NOSVE-NEXT:    ldr w30, [sp, #736] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #160] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #340]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #342]
; NONEON-NOSVE-NEXT:    stp q22, q19, [sp, #448]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #8] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #344]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #346]
; NONEON-NOSVE-NEXT:    str q6, [sp, #400]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #72] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #348]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #350]
; NONEON-NOSVE-NEXT:    str q3, [sp, #640]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #112] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #416]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #418]
; NONEON-NOSVE-NEXT:    stp q2, q1, [sp, #688]
; NONEON-NOSVE-NEXT:    ldrh w23, [sp, #654]
; NONEON-NOSVE-NEXT:    ldrh w24, [sp, #652]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #104] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #420]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #430]
; NONEON-NOSVE-NEXT:    ldrh w15, [sp, #718]
; NONEON-NOSVE-NEXT:    ldrh w16, [sp, #716]
; NONEON-NOSVE-NEXT:    ldrh w17, [sp, #714]
; NONEON-NOSVE-NEXT:    str w8, [sp, #268] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #422]
; NONEON-NOSVE-NEXT:    ldrh w18, [sp, #712]
; NONEON-NOSVE-NEXT:    ldrh w0, [sp, #710]
; NONEON-NOSVE-NEXT:    ldrh w1, [sp, #708]
; NONEON-NOSVE-NEXT:    ldrh w2, [sp, #706]
; NONEON-NOSVE-NEXT:    str w8, [sp, #264] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #424]
; NONEON-NOSVE-NEXT:    ldrh w3, [sp, #704]
; NONEON-NOSVE-NEXT:    ldrh w4, [sp, #702]
; NONEON-NOSVE-NEXT:    ldrh w5, [sp, #700]
; NONEON-NOSVE-NEXT:    ldrh w6, [sp, #698]
; NONEON-NOSVE-NEXT:    str w8, [sp, #324] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #426]
; NONEON-NOSVE-NEXT:    ldrh w7, [sp, #696]
; NONEON-NOSVE-NEXT:    ldrh w19, [sp, #694]
; NONEON-NOSVE-NEXT:    ldrh w20, [sp, #692]
; NONEON-NOSVE-NEXT:    ldrh w21, [sp, #690]
; NONEON-NOSVE-NEXT:    str w8, [sp, #320] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #428]
; NONEON-NOSVE-NEXT:    ldrh w22, [sp, #688]
; NONEON-NOSVE-NEXT:    ldrh w25, [sp, #650]
; NONEON-NOSVE-NEXT:    ldrh w26, [sp, #648]
; NONEON-NOSVE-NEXT:    ldrh w27, [sp, #646]
; NONEON-NOSVE-NEXT:    str w8, [sp, #788] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #432]
; NONEON-NOSVE-NEXT:    ldrh w28, [sp, #644]
; NONEON-NOSVE-NEXT:    ldrh w29, [sp, #642]
; NONEON-NOSVE-NEXT:    strb w30, [sp, #687]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #200] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #434]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #436]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #176] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #438]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #440]
; NONEON-NOSVE-NEXT:    str w8, [sp, #784] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #442]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #32] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #444]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #450]
; NONEON-NOSVE-NEXT:    str w8, [sp, #332] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #446]
; NONEON-NOSVE-NEXT:    str w8, [sp, #328] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #448]
; NONEON-NOSVE-NEXT:    str w8, [sp, #780] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #452]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #48] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #454]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #458]
; NONEON-NOSVE-NEXT:    str w8, [sp, #284] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #456]
; NONEON-NOSVE-NEXT:    str w8, [sp, #280] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #460]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #208] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #462]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #384]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #144] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #386]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #388]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #390]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #392]
; NONEON-NOSVE-NEXT:    str w8, [sp, #776] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #394]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #232] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #396]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #398]
; NONEON-NOSVE-NEXT:    str w8, [sp, #772] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #352]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #248] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #354]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #362]
; NONEON-NOSVE-NEXT:    str w8, [sp, #768] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #356]
; NONEON-NOSVE-NEXT:    str w8, [sp, #292] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #358]
; NONEON-NOSVE-NEXT:    str w8, [sp, #288] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #360]
; NONEON-NOSVE-NEXT:    str w8, [sp, #764] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #364]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #192] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #366]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #464]
; NONEON-NOSVE-NEXT:    str w8, [sp, #760] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #466]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #136] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #468]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #470]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #128] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #472]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #476]
; NONEON-NOSVE-NEXT:    str w8, [sp, #308] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #474]
; NONEON-NOSVE-NEXT:    str w8, [sp, #304] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #478]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #16] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #480]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #484]
; NONEON-NOSVE-NEXT:    str w8, [sp, #276] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #482]
; NONEON-NOSVE-NEXT:    str w8, [sp, #272] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #486]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #96] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #488]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #490]
; NONEON-NOSVE-NEXT:    str w8, [sp, #756] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #492]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #240] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #494]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #372]
; NONEON-NOSVE-NEXT:    str w8, [sp, #260] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #368]
; NONEON-NOSVE-NEXT:    str w8, [sp, #256] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #370]
; NONEON-NOSVE-NEXT:    str w8, [sp, #752] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #374]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #168] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #376]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #378]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #184] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #380]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #382]
; NONEON-NOSVE-NEXT:    str w8, [sp, #748] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #400]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #24] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #402]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #404]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #56] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #406]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #408]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #152] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #410]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #412]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #216] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #414]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #496]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #120] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #498]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #506]
; NONEON-NOSVE-NEXT:    str w8, [sp, #744] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #500]
; NONEON-NOSVE-NEXT:    str w8, [sp, #316] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #502]
; NONEON-NOSVE-NEXT:    str w8, [sp, #312] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #504]
; NONEON-NOSVE-NEXT:    str w8, [sp, #740] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #508]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #80] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #510]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #512]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #64] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #514]
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #516]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #88] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #518]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #524]
; NONEON-NOSVE-NEXT:    str w8, [sp, #300] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #520]
; NONEON-NOSVE-NEXT:    str w8, [sp, #296] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #522]
; NONEON-NOSVE-NEXT:    str w8, [sp, #732] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #526]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #224] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #640]
; NONEON-NOSVE-NEXT:    ldrh w9, [sp, #540]
; NONEON-NOSVE-NEXT:    str w8, [sp, #728] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldrh w8, [sp, #538]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strb w9, [sp, #686]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #685]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strb w8, [sp, #684]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strb w8, [sp, #683]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strb w8, [sp, #682]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strb w8, [sp, #681]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strb w8, [sp, #680]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strb w8, [sp, #679]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    strb w8, [sp, #678]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strb w8, [sp, #677]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    strb w8, [sp, #676]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strb w8, [sp, #675]
; NONEON-NOSVE-NEXT:    add w8, w1, w1
; NONEON-NOSVE-NEXT:    strb w8, [sp, #674]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    strb w8, [sp, #673]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strb w8, [sp, #672]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    strb w8, [sp, #671]
; NONEON-NOSVE-NEXT:    add w8, w5, w5
; NONEON-NOSVE-NEXT:    strb w8, [sp, #670]
; NONEON-NOSVE-NEXT:    add w8, w6, w6
; NONEON-NOSVE-NEXT:    strb w8, [sp, #669]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strb w8, [sp, #668]
; NONEON-NOSVE-NEXT:    add w8, w19, w19
; NONEON-NOSVE-NEXT:    strb w8, [sp, #667]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    strb w8, [sp, #666]
; NONEON-NOSVE-NEXT:    add w8, w21, w21
; NONEON-NOSVE-NEXT:    strb w8, [sp, #665]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    strb w8, [sp, #664]
; NONEON-NOSVE-NEXT:    add w8, w23, w23
; NONEON-NOSVE-NEXT:    strb w8, [sp, #663]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strb w8, [sp, #662]
; NONEON-NOSVE-NEXT:    add w8, w25, w25
; NONEON-NOSVE-NEXT:    strb w8, [sp, #661]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strb w8, [sp, #660]
; NONEON-NOSVE-NEXT:    add w8, w27, w27
; NONEON-NOSVE-NEXT:    strb w8, [sp, #659]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strb w8, [sp, #658]
; NONEON-NOSVE-NEXT:    add w8, w29, w29
; NONEON-NOSVE-NEXT:    strb w8, [sp, #657]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #728] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #656]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #224] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #656]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #575]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #228] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #574]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #732] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #573]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #296] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #572]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #300] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #571]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #570]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #92] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #569]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #64] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #568]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #68] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #567]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #80] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #566]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #84] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #565]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #740] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #564]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #312] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #563]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #316] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #562]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #744] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #561]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #120] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #560]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #124] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #607]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #216] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #606]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #220] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #605]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #152] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #604]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #156] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #603]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #56] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #602]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #60] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #601]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #24] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #600]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #28] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #599]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #748] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #598]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #184] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #597]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #188] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #596]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #168] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #595]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #172] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #594]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #752] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #593]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #256] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #592]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #260] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldr q4, [sp, #592]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #623]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #240] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #622]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #244] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #621]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #756] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #620]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #96] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #619]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #100] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #618]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #272] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #617]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #276] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #616]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #16] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #615]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #20] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #614]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #304] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #613]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #308] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #612]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #128] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #611]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #132] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #610]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #136] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #609]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #140] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #608]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #760] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #559]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #192] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #558]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #196] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #557]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #764] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #556]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #288] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #555]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #292] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #554]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #768] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #553]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #248] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #552]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #252] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #551]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #772] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #550]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #232] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #549]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #236] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #548]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #776] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #547]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #546]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #545]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #144] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #544]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #148] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldr q7, [sp, #544]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #591]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #208] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #590]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #212] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #589]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #280] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #588]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #284] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #587]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #48] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #586]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #52] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #585]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #780] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #584]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #328] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #583]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #332] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #582]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #581]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #36] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #580]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #784] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #579]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #176] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #578]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #180] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #577]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #200] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #576]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #204] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q3, q5, [sp, #560]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #639]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #788] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #638]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #320] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #637]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #324] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #636]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #264] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #635]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #268] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #634]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #104] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #633]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #108] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #632]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #112] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #631]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #116] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #630]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #72] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #629]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #76] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #628]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #8] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #627]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #12] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #626]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #160] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #625]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #164] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #624]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #792] // 8-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q6, q2, [sp, #608]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x8]
; NONEON-NOSVE-NEXT:    stp q4, q3, [x8, #32]
; NONEON-NOSVE-NEXT:    stp q7, q6, [x8, #64]
; NONEON-NOSVE-NEXT:    stp q2, q5, [x8, #96]
; NONEON-NOSVE-NEXT:    add sp, sp, #800
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #80] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #64] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #48] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #32] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #16] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp], #96 // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ret
  %a = load <128 x i16>, ptr %in
  %b = trunc <128 x i16> %a to <128 x i8>
  %c = add <128 x i8> %b, %b
  store <128 x i8> %c, ptr %out
  ret void
}

;
; truncate i32 -> i8
;

define <8 x i8> @trunc_v8i32_v8i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v8i32_v8i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z3.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z2.h, z1.h, z1.h
; CHECK-NEXT:    splice z0.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    uzp1 z0.b, z0.b, z0.b
; CHECK-NEXT:    // kill: def $d0 killed $d0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v8i32_v8i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #48
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #40]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #15]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #14]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #32]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #13]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #12]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #24]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #11]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #10]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #16]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #9]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #8]
; NONEON-NOSVE-NEXT:    ldr d0, [sp, #8]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <8 x i32>, ptr %in
  %b = trunc <8 x i32> %a to <8 x i8>
  ret <8 x i8> %b
}

define <16 x i8> @trunc_v16i32_v16i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v16i32_v16i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z4.h, z1.h, z1.h
; CHECK-NEXT:    uzp1 z1.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z0.h, z3.h, z3.h
; CHECK-NEXT:    splice z2.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    splice z0.h, p0, { z0.h, z1.h }
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z2.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z1.b, z0.b, z0.b
; CHECK-NEXT:    splice z0.b, p0, { z1.b, z2.b }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i32_v16i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #80
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q2, q3, [x0]
; NONEON-NOSVE-NEXT:    stp q0, q1, [sp, #32]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #40]
; NONEON-NOSVE-NEXT:    stp q3, q2, [sp]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #79]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #78]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #32]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #77]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #76]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #56]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #75]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #74]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #48]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #73]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #72]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #8]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #71]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #70]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #69]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #68]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #24]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #67]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #66]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #16]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #65]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #64]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #64]
; NONEON-NOSVE-NEXT:    add sp, sp, #80
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i32>, ptr %in
  %b = trunc <16 x i32> %a to <16 x i8>
  ret <16 x i8> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i32_v32i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i32_v32i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q0, q1, [x0, #96]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q2, q3, [x0, #32]
; CHECK-NEXT:    ldp q4, q5, [x0, #64]
; CHECK-NEXT:    ldp q6, q7, [x0]
; CHECK-NEXT:    uzp1 z17.h, z1.h, z1.h
; CHECK-NEXT:    uzp1 z16.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z1.h, z3.h, z3.h
; CHECK-NEXT:    uzp1 z19.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z0.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z3.h, z7.h, z7.h
; CHECK-NEXT:    uzp1 z18.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z2.h, z6.h, z6.h
; CHECK-NEXT:    splice z4.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    splice z0.h, p0, { z0.h, z1.h }
; CHECK-NEXT:    splice z5.h, p0, { z18.h, z19.h }
; CHECK-NEXT:    splice z1.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z3.b, z4.b, z4.b
; CHECK-NEXT:    uzp1 z7.b, z0.b, z0.b
; CHECK-NEXT:    uzp1 z2.b, z5.b, z5.b
; CHECK-NEXT:    uzp1 z6.b, z1.b, z1.b
; CHECK-NEXT:    splice z0.b, p0, { z2.b, z3.b }
; CHECK-NEXT:    splice z1.b, p0, { z6.b, z7.b }
; CHECK-NEXT:    add z0.b, z0.b, z0.b
; CHECK-NEXT:    add z1.b, z1.b, z1.b
; CHECK-NEXT:    stp q1, q0, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i32_v32i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #288
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #208] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #64]
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #224] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #240] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #256] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #96]
; NONEON-NOSVE-NEXT:    str q2, [sp, #16]
; NONEON-NOSVE-NEXT:    stp q0, q1, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q4, q3, [sp, #96]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #24]
; NONEON-NOSVE-NEXT:    ldp w27, w28, [sp, #112]
; NONEON-NOSVE-NEXT:    ldp w25, w26, [sp, #104]
; NONEON-NOSVE-NEXT:    add w6, w8, w8
; NONEON-NOSVE-NEXT:    add w5, w9, w9
; NONEON-NOSVE-NEXT:    str q5, [sp, #48]
; NONEON-NOSVE-NEXT:    ldp w10, w8, [sp, #80]
; NONEON-NOSVE-NEXT:    ldp w23, w24, [sp, #96]
; NONEON-NOSVE-NEXT:    ldp w21, w22, [sp, #56]
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #120]
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #272] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp q7, q6, [sp, #160]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #192] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    strb w8, [sp, #139]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strb w9, [sp, #138]
; NONEON-NOSVE-NEXT:    add w9, w27, w27
; NONEON-NOSVE-NEXT:    ldp w19, w20, [sp, #48]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #137]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strb w9, [sp, #136]
; NONEON-NOSVE-NEXT:    add w9, w25, w25
; NONEON-NOSVE-NEXT:    ldp w4, w7, [sp, #184]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #135]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strb w9, [sp, #134]
; NONEON-NOSVE-NEXT:    add w9, w23, w23
; NONEON-NOSVE-NEXT:    ldp w2, w3, [sp, #176]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #133]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    strb w9, [sp, #132]
; NONEON-NOSVE-NEXT:    add w9, w21, w21
; NONEON-NOSVE-NEXT:    ldp w18, w0, [sp, #168]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #131]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    strb w9, [sp, #130]
; NONEON-NOSVE-NEXT:    add w9, w19, w19
; NONEON-NOSVE-NEXT:    ldp w16, w17, [sp, #160]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #129]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strb w9, [sp, #128]
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    ldp w14, w15, [sp, #72]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #159]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strb w9, [sp, #158]
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    ldp w12, w13, [sp, #64]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #157]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strb w9, [sp, #156]
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    ldp w10, w11, [sp, #88]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #155]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strb w9, [sp, #154]
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    strb w8, [sp, #153]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strb w9, [sp, #152]
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    strb w8, [sp, #151]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strb w9, [sp, #150]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    ldp w29, w30, [sp, #16]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #149]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strb w9, [sp, #148]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    strb w8, [sp, #147]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w9, [sp, #146]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w5, [sp, #143]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w6, [sp, #142]
; NONEON-NOSVE-NEXT:    add w6, w29, w29
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strb w5, [sp, #141]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #272] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w6, [sp, #140]
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #256] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #145]
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #240] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w9, [sp, #144]
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #224] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #128]
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #208] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #192] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    add sp, sp, #288
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i32>, ptr %in
  %b = trunc <32 x i32> %a to <32 x i8>
  %c = add <32 x i8> %b, %b
  store <32 x i8> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v64i32_v64i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v64i32_v64i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q2, q3, [x0, #160]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q4, q5, [x0, #96]
; CHECK-NEXT:    ldp q6, q7, [x0]
; CHECK-NEXT:    uzp1 z17.h, z3.h, z3.h
; CHECK-NEXT:    ldp q3, q18, [x0, #128]
; CHECK-NEXT:    uzp1 z16.h, z2.h, z2.h
; CHECK-NEXT:    ldp q2, q19, [x0, #192]
; CHECK-NEXT:    ldp q0, q1, [x0, #64]
; CHECK-NEXT:    uzp1 z21.h, z18.h, z18.h
; CHECK-NEXT:    ldp q18, q22, [x0, #224]
; CHECK-NEXT:    uzp1 z20.h, z3.h, z3.h
; CHECK-NEXT:    ldp q3, q23, [x0, #32]
; CHECK-NEXT:    splice z16.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    uzp1 z27.h, z19.h, z19.h
; CHECK-NEXT:    uzp1 z25.h, z22.h, z22.h
; CHECK-NEXT:    uzp1 z26.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z24.h, z18.h, z18.h
; CHECK-NEXT:    uzp1 z18.h, z23.h, z23.h
; CHECK-NEXT:    uzp1 z23.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z17.h, z3.h, z3.h
; CHECK-NEXT:    uzp1 z3.h, z7.h, z7.h
; CHECK-NEXT:    uzp1 z22.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z2.h, z6.h, z6.h
; CHECK-NEXT:    uzp1 z5.h, z1.h, z1.h
; CHECK-NEXT:    splice z1.h, p0, { z20.h, z21.h }
; CHECK-NEXT:    splice z6.h, p0, { z24.h, z25.h }
; CHECK-NEXT:    uzp1 z4.h, z0.h, z0.h
; CHECK-NEXT:    splice z0.h, p0, { z26.h, z27.h }
; CHECK-NEXT:    splice z7.h, p0, { z17.h, z18.h }
; CHECK-NEXT:    uzp1 z17.b, z16.b, z16.b
; CHECK-NEXT:    splice z2.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    splice z3.h, p0, { z22.h, z23.h }
; CHECK-NEXT:    splice z4.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    uzp1 z16.b, z1.b, z1.b
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z6.b, z6.b, z6.b
; CHECK-NEXT:    uzp1 z5.b, z0.b, z0.b
; CHECK-NEXT:    uzp1 z1.b, z7.b, z7.b
; CHECK-NEXT:    uzp1 z0.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z3.b, z3.b, z3.b
; CHECK-NEXT:    splice z7.b, p0, { z16.b, z17.b }
; CHECK-NEXT:    uzp1 z2.b, z4.b, z4.b
; CHECK-NEXT:    splice z4.b, p0, { z5.b, z6.b }
; CHECK-NEXT:    splice z0.b, p0, { z0.b, z1.b }
; CHECK-NEXT:    splice z1.b, p0, { z2.b, z3.b }
; CHECK-NEXT:    add z2.b, z7.b, z7.b
; CHECK-NEXT:    add z3.b, z4.b, z4.b
; CHECK-NEXT:    add z0.b, z0.b, z0.b
; CHECK-NEXT:    add z1.b, z1.b, z1.b
; CHECK-NEXT:    stp q2, q3, [x1, #32]
; CHECK-NEXT:    stp q0, q1, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v64i32_v64i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #-96]! // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #16] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #32] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #48] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #64] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #80] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    sub sp, sp, #480
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #128]
; NONEON-NOSVE-NEXT:    str x1, [sp, #472] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #96]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0]
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #224]
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #192]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #160]
; NONEON-NOSVE-NEXT:    stp q16, q17, [sp, #160]
; NONEON-NOSVE-NEXT:    stp q19, q18, [sp, #240]
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #176]
; NONEON-NOSVE-NEXT:    stp q21, q20, [sp, #128]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #336]
; NONEON-NOSVE-NEXT:    str w9, [sp, #468] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #364]
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #340]
; NONEON-NOSVE-NEXT:    ldp w9, w11, [sp, #184]
; NONEON-NOSVE-NEXT:    add w20, w8, w8
; NONEON-NOSVE-NEXT:    str q7, [sp, #112]
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #336]
; NONEON-NOSVE-NEXT:    stp q2, q4, [sp, #208]
; NONEON-NOSVE-NEXT:    ldr w22, [sp, #360]
; NONEON-NOSVE-NEXT:    stp w9, w10, [sp, #24] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #160]
; NONEON-NOSVE-NEXT:    stp q23, q22, [sp, #272]
; NONEON-NOSVE-NEXT:    ldp w15, w14, [sp, #216]
; NONEON-NOSVE-NEXT:    stp w9, w11, [sp, #32] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    str w8, [sp, #464] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #168]
; NONEON-NOSVE-NEXT:    ldp w17, w16, [sp, #208]
; NONEON-NOSVE-NEXT:    str q3, [sp, #192]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #56] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #272]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #276]
; NONEON-NOSVE-NEXT:    ldp w0, w18, [sp, #200]
; NONEON-NOSVE-NEXT:    str w8, [sp, #460] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #280]
; NONEON-NOSVE-NEXT:    ldp w2, w1, [sp, #192]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #64] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #284]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #288]
; NONEON-NOSVE-NEXT:    ldp w4, w3, [sp, #232]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #96] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #292]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #296]
; NONEON-NOSVE-NEXT:    ldp w6, w5, [sp, #224]
; NONEON-NOSVE-NEXT:    str w8, [sp, #456] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #300]
; NONEON-NOSVE-NEXT:    stp q6, q5, [sp, #400]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #48] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w7, [sp, #428]
; NONEON-NOSVE-NEXT:    ldr w19, [sp, #424]
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w21, [sp, #420]
; NONEON-NOSVE-NEXT:    ldr w23, [sp, #416]
; NONEON-NOSVE-NEXT:    ldr w24, [sp, #412]
; NONEON-NOSVE-NEXT:    ldr w25, [sp, #408]
; NONEON-NOSVE-NEXT:    ldr w26, [sp, #404]
; NONEON-NOSVE-NEXT:    ldr w27, [sp, #400]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #104] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #136]
; NONEON-NOSVE-NEXT:    ldp w29, w28, [sp, #120]
; NONEON-NOSVE-NEXT:    strb w20, [sp, #399]
; NONEON-NOSVE-NEXT:    add w20, w22, w22
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #144]
; NONEON-NOSVE-NEXT:    strb w20, [sp, #398]
; NONEON-NOSVE-NEXT:    str w9, [sp, #452] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w11, [sp, #152]
; NONEON-NOSVE-NEXT:    stp w9, w10, [sp, #88] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #352]
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #240]
; NONEON-NOSVE-NEXT:    stp w9, w11, [sp, #16] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #344]
; NONEON-NOSVE-NEXT:    str w8, [sp, #448] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #248]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #8] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #256]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #260]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #72] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #264]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #268]
; NONEON-NOSVE-NEXT:    str w8, [sp, #444] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w8, w30, [sp, #112]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #80] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #356]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #348]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #397]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strb w8, [sp, #396]
; NONEON-NOSVE-NEXT:    add w8, w9, w9
; NONEON-NOSVE-NEXT:    strb w8, [sp, #395]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strb w8, [sp, #394]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strb w8, [sp, #393]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strb w8, [sp, #392]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strb w8, [sp, #391]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strb w8, [sp, #390]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    strb w8, [sp, #389]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strb w8, [sp, #388]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    strb w8, [sp, #387]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strb w8, [sp, #386]
; NONEON-NOSVE-NEXT:    add w8, w1, w1
; NONEON-NOSVE-NEXT:    strb w8, [sp, #385]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    strb w8, [sp, #384]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strb w8, [sp, #383]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    strb w8, [sp, #382]
; NONEON-NOSVE-NEXT:    add w8, w5, w5
; NONEON-NOSVE-NEXT:    strb w8, [sp, #381]
; NONEON-NOSVE-NEXT:    add w8, w6, w6
; NONEON-NOSVE-NEXT:    strb w8, [sp, #380]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strb w8, [sp, #379]
; NONEON-NOSVE-NEXT:    add w8, w19, w19
; NONEON-NOSVE-NEXT:    strb w8, [sp, #378]
; NONEON-NOSVE-NEXT:    add w8, w21, w21
; NONEON-NOSVE-NEXT:    strb w8, [sp, #377]
; NONEON-NOSVE-NEXT:    add w8, w23, w23
; NONEON-NOSVE-NEXT:    strb w8, [sp, #376]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strb w8, [sp, #375]
; NONEON-NOSVE-NEXT:    add w8, w25, w25
; NONEON-NOSVE-NEXT:    strb w8, [sp, #374]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strb w8, [sp, #373]
; NONEON-NOSVE-NEXT:    add w8, w27, w27
; NONEON-NOSVE-NEXT:    strb w8, [sp, #372]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strb w8, [sp, #371]
; NONEON-NOSVE-NEXT:    add w8, w29, w29
; NONEON-NOSVE-NEXT:    strb w8, [sp, #370]
; NONEON-NOSVE-NEXT:    add w8, w30, w30
; NONEON-NOSVE-NEXT:    strb w8, [sp, #369]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #80] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #368]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #84] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q3, q2, [sp, #368]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #319]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #444] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #318]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #72] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #317]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #76] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #316]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #8] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #315]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #12] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #314]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #448] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #313]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #16] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #312]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #20] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #311]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #310]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #92] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #309]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #452] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #308]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #307]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #306]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #104] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #305]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #108] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #304]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #48] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #335]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #52] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #334]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #456] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #333]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #96] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #332]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #100] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #331]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #64] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #330]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #68] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #329]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #460] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #328]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #56] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #327]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #60] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #326]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #464] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #325]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #324]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #36] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #323]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #24] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #322]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #28] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #321]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #468] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strb w8, [sp, #320]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #472] // 8-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #304]
; NONEON-NOSVE-NEXT:    stp q3, q2, [x8]
; NONEON-NOSVE-NEXT:    stp q0, q1, [x8, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #480
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #80] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #64] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #48] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #32] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #16] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp], #96 // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ret
  %a = load <64 x i32>, ptr %in
  %b = trunc <64 x i32> %a to <64 x i8>
  %c = add <64 x i8> %b, %b
  store <64 x i8> %c, ptr %out
  ret void
}

;
; truncate i32 -> i16
;

define <8 x i16> @trunc_v8i32_v8i16(ptr %in) nounwind {
; CHECK-LABEL: trunc_v8i32_v8i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z3.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z2.h, z1.h, z1.h
; CHECK-NEXT:    splice z0.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v8i32_v8i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #-48]!
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #24]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #46]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #44]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #42]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #40]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #8]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #38]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #36]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #34]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <8 x i32>, ptr %in
  %b = trunc <8 x i32> %a to <8 x i16>
  ret <8 x i16> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v16i32_v16i16(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v16i32_v16i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z4.h, z1.h, z1.h
; CHECK-NEXT:    uzp1 z1.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z0.h, z3.h, z3.h
; CHECK-NEXT:    splice z2.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    splice z0.h, p0, { z0.h, z1.h }
; CHECK-NEXT:    add z1.h, z2.h, z2.h
; CHECK-NEXT:    add z0.h, z0.h, z0.h
; CHECK-NEXT:    stp q0, q1, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i32_v16i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #96
; NONEON-NOSVE-NEXT:    ldp q0, q1, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    stp q3, q1, [sp, #32]
; NONEON-NOSVE-NEXT:    stp q2, q0, [sp, #64]
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #72]
; NONEON-NOSVE-NEXT:    ldp w2, w3, [sp, #64]
; NONEON-NOSVE-NEXT:    ldp w4, w5, [sp, #40]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    ldp w18, w0, [sp, #32]
; NONEON-NOSVE-NEXT:    ldp w16, w17, [sp, #56]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #14]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strh w9, [sp, #12]
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    ldp w14, w15, [sp, #48]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #10]
; NONEON-NOSVE-NEXT:    add w8, w5, w5
; NONEON-NOSVE-NEXT:    strh w9, [sp, #8]
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    ldp w12, w13, [sp, #88]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #6]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strh w9, [sp, #4]
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    ldp w10, w11, [sp, #80]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #2]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strh w9, [sp]
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    strh w8, [sp, #30]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strh w9, [sp, #28]
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    strh w8, [sp, #26]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strh w9, [sp, #24]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    strh w8, [sp, #22]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strh w9, [sp, #20]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    strh w8, [sp, #18]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    add sp, sp, #96
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i32>, ptr %in
  %b = trunc <16 x i32> %a to <16 x i16>
  %c = add <16 x i16> %b, %b
  store <16 x i16> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i32_v32i16(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i32_v32i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #64]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q2, q3, [x0, #96]
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    uzp1 z7.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z6.h, z1.h, z1.h
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    uzp1 z17.h, z3.h, z3.h
; CHECK-NEXT:    uzp1 z16.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z3.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z2.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z5.h, z0.h, z0.h
; CHECK-NEXT:    splice z0.h, p0, { z6.h, z7.h }
; CHECK-NEXT:    uzp1 z4.h, z1.h, z1.h
; CHECK-NEXT:    splice z1.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    splice z2.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    splice z3.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    add z0.h, z0.h, z0.h
; CHECK-NEXT:    add z1.h, z1.h, z1.h
; CHECK-NEXT:    add z2.h, z2.h, z2.h
; CHECK-NEXT:    add z3.h, z3.h, z3.h
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i32_v32i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #320
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #240] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #64]
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #256] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #272] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #288] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #96]
; NONEON-NOSVE-NEXT:    str q2, [sp, #16]
; NONEON-NOSVE-NEXT:    stp q0, q1, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q4, q3, [sp, #160]
; NONEON-NOSVE-NEXT:    ldp w8, w9, [sp, #24]
; NONEON-NOSVE-NEXT:    ldp w27, w28, [sp, #176]
; NONEON-NOSVE-NEXT:    ldp w25, w26, [sp, #168]
; NONEON-NOSVE-NEXT:    add w6, w8, w8
; NONEON-NOSVE-NEXT:    add w5, w9, w9
; NONEON-NOSVE-NEXT:    str q5, [sp, #48]
; NONEON-NOSVE-NEXT:    ldp w10, w8, [sp, #80]
; NONEON-NOSVE-NEXT:    ldp w23, w24, [sp, #160]
; NONEON-NOSVE-NEXT:    ldp w21, w22, [sp, #56]
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w8, [sp, #184]
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #304] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp q7, q6, [sp, #192]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #224] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    strh w8, [sp, #150]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strh w9, [sp, #148]
; NONEON-NOSVE-NEXT:    add w9, w27, w27
; NONEON-NOSVE-NEXT:    ldp w19, w20, [sp, #48]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #146]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strh w9, [sp, #144]
; NONEON-NOSVE-NEXT:    add w9, w25, w25
; NONEON-NOSVE-NEXT:    ldp w4, w7, [sp, #216]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #142]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strh w9, [sp, #140]
; NONEON-NOSVE-NEXT:    add w9, w23, w23
; NONEON-NOSVE-NEXT:    ldp w2, w3, [sp, #208]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #138]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    strh w9, [sp, #136]
; NONEON-NOSVE-NEXT:    add w9, w21, w21
; NONEON-NOSVE-NEXT:    ldp w18, w0, [sp, #200]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #134]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    strh w9, [sp, #132]
; NONEON-NOSVE-NEXT:    add w9, w19, w19
; NONEON-NOSVE-NEXT:    ldp w16, w17, [sp, #192]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #130]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strh w9, [sp, #128]
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    ldp w14, w15, [sp, #72]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #110]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strh w9, [sp, #108]
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    ldp w12, w13, [sp, #64]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #106]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strh w9, [sp, #104]
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    ldp w10, w11, [sp, #88]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #102]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strh w9, [sp, #100]
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    strh w8, [sp, #98]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strh w9, [sp, #96]
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    strh w8, [sp, #126]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strh w9, [sp, #124]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    ldp w29, w30, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #122]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strh w9, [sp, #120]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    strh w8, [sp, #118]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w9, [sp, #116]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w5, [sp, #158]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w6, [sp, #156]
; NONEON-NOSVE-NEXT:    add w6, w29, w29
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strh w5, [sp, #154]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #304] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w6, [sp, #152]
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #288] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w8, [sp, #114]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [sp, #128]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #112]
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #272] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #96]
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #256] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q3, q2, [x1]
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #240] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #224] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q0, q1, [x1, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #320
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i32>, ptr %in
  %b = trunc <32 x i32> %a to <32 x i16>
  %c = add <32 x i16> %b, %b
  store <32 x i16> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v64i32_v64i16(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v64i32_v64i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q2, q3, [x0, #192]
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    ldp q6, q7, [x0, #64]
; CHECK-NEXT:    uzp1 z17.h, z3.h, z3.h
; CHECK-NEXT:    ldp q3, q18, [x0, #224]
; CHECK-NEXT:    uzp1 z16.h, z2.h, z2.h
; CHECK-NEXT:    ldp q2, q19, [x0, #128]
; CHECK-NEXT:    ldp q0, q1, [x0, #32]
; CHECK-NEXT:    uzp1 z21.h, z18.h, z18.h
; CHECK-NEXT:    ldp q18, q22, [x0, #160]
; CHECK-NEXT:    uzp1 z20.h, z3.h, z3.h
; CHECK-NEXT:    uzp1 z24.h, z19.h, z19.h
; CHECK-NEXT:    ldp q3, q19, [x0, #96]
; CHECK-NEXT:    uzp1 z23.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z26.h, z22.h, z22.h
; CHECK-NEXT:    splice z2.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    uzp1 z17.h, z7.h, z7.h
; CHECK-NEXT:    uzp1 z25.h, z18.h, z18.h
; CHECK-NEXT:    splice z7.h, p0, { z20.h, z21.h }
; CHECK-NEXT:    uzp1 z21.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z19.h, z19.h, z19.h
; CHECK-NEXT:    uzp1 z20.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z5.h, z1.h, z1.h
; CHECK-NEXT:    uzp1 z16.h, z6.h, z6.h
; CHECK-NEXT:    splice z6.h, p0, { z23.h, z24.h }
; CHECK-NEXT:    uzp1 z18.h, z3.h, z3.h
; CHECK-NEXT:    splice z3.h, p0, { z25.h, z26.h }
; CHECK-NEXT:    uzp1 z4.h, z0.h, z0.h
; CHECK-NEXT:    add z0.h, z2.h, z2.h
; CHECK-NEXT:    add z7.h, z7.h, z7.h
; CHECK-NEXT:    splice z1.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    splice z2.h, p0, { z18.h, z19.h }
; CHECK-NEXT:    splice z16.h, p0, { z20.h, z21.h }
; CHECK-NEXT:    splice z4.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    add z6.h, z6.h, z6.h
; CHECK-NEXT:    add z3.h, z3.h, z3.h
; CHECK-NEXT:    stp q0, q7, [x1, #96]
; CHECK-NEXT:    add z0.h, z1.h, z1.h
; CHECK-NEXT:    add z1.h, z2.h, z2.h
; CHECK-NEXT:    add z2.h, z16.h, z16.h
; CHECK-NEXT:    stp q6, q3, [x1, #64]
; CHECK-NEXT:    add z3.h, z4.h, z4.h
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v64i32_v64i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #-96]! // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #16] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #32] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #48] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #64] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #80] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    sub sp, sp, #544
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #192]
; NONEON-NOSVE-NEXT:    mov x5, x1
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #96]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #160]
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #128]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #224]
; NONEON-NOSVE-NEXT:    stp q17, q16, [sp, #160]
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #160]
; NONEON-NOSVE-NEXT:    str q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp w23, w8, [sp, #24]
; NONEON-NOSVE-NEXT:    str w9, [sp, #540] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w11, [sp, #168]
; NONEON-NOSVE-NEXT:    add w21, w8, w8
; NONEON-NOSVE-NEXT:    stp q20, q21, [sp, #192]
; NONEON-NOSVE-NEXT:    stp q6, q7, [sp, #304]
; NONEON-NOSVE-NEXT:    stp w9, w10, [sp, #152] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w25, [sp, #316]
; NONEON-NOSVE-NEXT:    ldr w26, [sp, #312]
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #176]
; NONEON-NOSVE-NEXT:    stp q19, q18, [sp, #400]
; NONEON-NOSVE-NEXT:    ldr w27, [sp, #308]
; NONEON-NOSVE-NEXT:    ldr w28, [sp, #304]
; NONEON-NOSVE-NEXT:    stp q23, q22, [sp, #432]
; NONEON-NOSVE-NEXT:    ldr w29, [sp, #332]
; NONEON-NOSVE-NEXT:    ldr w30, [sp, #328]
; NONEON-NOSVE-NEXT:    stp w9, w11, [sp, #80] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #432]
; NONEON-NOSVE-NEXT:    ldp w9, w11, [sp, #184]
; NONEON-NOSVE-NEXT:    stp q2, q1, [sp, #464]
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #484]
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #480]
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #476]
; NONEON-NOSVE-NEXT:    stp w9, w10, [sp, #48] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #436]
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #472]
; NONEON-NOSVE-NEXT:    stp w8, w11, [sp, #136] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #440]
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #468]
; NONEON-NOSVE-NEXT:    str q3, [sp, #224]
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #464]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #96] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #444]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #448]
; NONEON-NOSVE-NEXT:    stp q5, q4, [sp, #496]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #32] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #452]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #456]
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #524]
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #520]
; NONEON-NOSVE-NEXT:    ldr w6, [sp, #516]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #128] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #460]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #400]
; NONEON-NOSVE-NEXT:    ldr w7, [sp, #512]
; NONEON-NOSVE-NEXT:    ldr w19, [sp, #508]
; NONEON-NOSVE-NEXT:    ldr w20, [sp, #504]
; NONEON-NOSVE-NEXT:    ldr w22, [sp, #500]
; NONEON-NOSVE-NEXT:    ldr w24, [sp, #496]
; NONEON-NOSVE-NEXT:    strh w21, [sp, #398]
; NONEON-NOSVE-NEXT:    add w21, w23, w23
; NONEON-NOSVE-NEXT:    strh w21, [sp, #396]
; NONEON-NOSVE-NEXT:    ldp w10, w11, [sp, #208]
; NONEON-NOSVE-NEXT:    ldp w0, w18, [sp, #232]
; NONEON-NOSVE-NEXT:    ldp w2, w1, [sp, #224]
; NONEON-NOSVE-NEXT:    stp w10, w9, [sp, #72] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #216]
; NONEON-NOSVE-NEXT:    stp w9, w11, [sp, #104] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w11, [sp, #192]
; NONEON-NOSVE-NEXT:    stp w9, w10, [sp, #40] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp w9, w10, [sp, #200]
; NONEON-NOSVE-NEXT:    stp w9, w11, [sp, #88] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #404]
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #488]
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #56] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #408]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #120] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #412]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #416]
; NONEON-NOSVE-NEXT:    str w8, [sp, #536] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #420]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #112] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #424]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #428]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #144] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #320]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #324]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #64] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #492]
; NONEON-NOSVE-NEXT:    ldp w10, w8, [sp, #16]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #394]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strh w8, [sp, #392]
; NONEON-NOSVE-NEXT:    add w8, w9, w9
; NONEON-NOSVE-NEXT:    strh w8, [sp, #390]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strh w8, [sp, #388]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strh w8, [sp, #386]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strh w8, [sp, #384]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strh w8, [sp, #382]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strh w8, [sp, #380]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    strh w8, [sp, #378]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strh w8, [sp, #376]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    strh w8, [sp, #374]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strh w8, [sp, #372]
; NONEON-NOSVE-NEXT:    add w8, w1, w1
; NONEON-NOSVE-NEXT:    strh w8, [sp, #370]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    strh w8, [sp, #368]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strh w8, [sp, #366]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    strh w8, [sp, #364]
; NONEON-NOSVE-NEXT:    add w8, w6, w6
; NONEON-NOSVE-NEXT:    strh w8, [sp, #362]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strh w8, [sp, #360]
; NONEON-NOSVE-NEXT:    add w8, w19, w19
; NONEON-NOSVE-NEXT:    strh w8, [sp, #358]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    strh w8, [sp, #356]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    strh w8, [sp, #354]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    strh w8, [sp, #352]
; NONEON-NOSVE-NEXT:    add w8, w25, w25
; NONEON-NOSVE-NEXT:    strh w8, [sp, #350]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strh w8, [sp, #348]
; NONEON-NOSVE-NEXT:    add w8, w27, w27
; NONEON-NOSVE-NEXT:    strh w8, [sp, #346]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strh w8, [sp, #344]
; NONEON-NOSVE-NEXT:    add w8, w29, w29
; NONEON-NOSVE-NEXT:    strh w8, [sp, #342]
; NONEON-NOSVE-NEXT:    add w8, w30, w30
; NONEON-NOSVE-NEXT:    strh w8, [sp, #340]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #64] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #368]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #338]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #68] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #336]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #144] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q4, q3, [sp, #336]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #254]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #148] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #252]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #112] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #250]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #116] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #248]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #536] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #246]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #120] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #244]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #124] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #242]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #56] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #240]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #60] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #270]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #268]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #92] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #266]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #264]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #44] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #262]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #104] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #260]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #108] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #258]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #72] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #256]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #76] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q6, q7, [sp, #240]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #286]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #128] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #284]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #132] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #282]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #280]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #36] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #278]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #96] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #276]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #100] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #274]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #136] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #272]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #140] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #302]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #48] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #300]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #52] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #298]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #80] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #296]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #84] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #294]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #152] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #292]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #156] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #290]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #540] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w8, [sp, #288]
; NONEON-NOSVE-NEXT:    ldp q5, q2, [sp, #272]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x5]
; NONEON-NOSVE-NEXT:    stp q4, q3, [x5, #32]
; NONEON-NOSVE-NEXT:    stp q7, q6, [x5, #64]
; NONEON-NOSVE-NEXT:    stp q2, q5, [x5, #96]
; NONEON-NOSVE-NEXT:    add sp, sp, #544
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #80] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #64] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #48] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #32] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #16] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp], #96 // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ret
  %a = load <64 x i32>, ptr %in
  %b = trunc <64 x i32> %a to <64 x i16>
  %c = add <64 x i16> %b, %b
  store <64 x i16> %c, ptr %out
  ret void
}

;
; truncate i64 -> i8
;

; NOTE: v4i8 is not legal so result i8 elements are held within i16 containers.
define <4 x i8> @trunc_v4i64_v4i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v4i64_v4i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    uzp1 z3.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z2.s, z1.s, z1.s
; CHECK-NEXT:    splice z0.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    uzp1 z0.h, z0.h, z0.h
; CHECK-NEXT:    // kill: def $d0 killed $d0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v4i64_v4i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #48
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp, #32]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #12]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #14]
; NONEON-NOSVE-NEXT:    strh w10, [sp, #10]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #8]
; NONEON-NOSVE-NEXT:    ldr d0, [sp, #8]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <4 x i64>, ptr %in
  %b = trunc <4 x i64> %a to <4 x i8>
  ret <4 x i8> %b
}

define <8 x i8> @trunc_v8i64_v8i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v8i64_v8i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z4.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z1.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z0.s, z3.s, z3.s
; CHECK-NEXT:    splice z2.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    splice z0.s, p0, { z0.s, z1.s }
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z2.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z1.h, z0.h, z0.h
; CHECK-NEXT:    splice z0.h, p0, { z1.h, z2.h }
; CHECK-NEXT:    uzp1 z0.b, z0.b, z0.b
; CHECK-NEXT:    // kill: def $d0 killed $d0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v8i64_v8i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #80
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q2, q3, [x0]
; NONEON-NOSVE-NEXT:    str q1, [sp, #48]
; NONEON-NOSVE-NEXT:    stp q0, q3, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp, #16]
; NONEON-NOSVE-NEXT:    str q2, [sp]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #78]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp, #48]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #79]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #76]
; NONEON-NOSVE-NEXT:    ldp x8, x11, [sp, #32]
; NONEON-NOSVE-NEXT:    strb w10, [sp, #77]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #74]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #8]
; NONEON-NOSVE-NEXT:    strb w11, [sp, #75]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #73]
; NONEON-NOSVE-NEXT:    ldr x8, [sp]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #72]
; NONEON-NOSVE-NEXT:    ldr d0, [sp, #72]
; NONEON-NOSVE-NEXT:    add sp, sp, #80
; NONEON-NOSVE-NEXT:    ret
  %a = load <8 x i64>, ptr %in
  %b = trunc <8 x i64> %a to <8 x i8>
  ret <8 x i8> %b
}

define <16 x i8> @trunc_v16i64_v16i8(ptr %in) nounwind {
; CHECK-LABEL: trunc_v16i64_v16i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q0, q1, [x0, #96]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q2, q3, [x0, #32]
; CHECK-NEXT:    ldp q4, q5, [x0, #64]
; CHECK-NEXT:    ldp q6, q7, [x0]
; CHECK-NEXT:    uzp1 z17.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z16.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z19.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z1.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z18.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z0.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z3.s, z7.s, z7.s
; CHECK-NEXT:    uzp1 z2.s, z6.s, z6.s
; CHECK-NEXT:    splice z4.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    splice z0.s, p0, { z0.s, z1.s }
; CHECK-NEXT:    splice z1.s, p0, { z18.s, z19.s }
; CHECK-NEXT:    splice z2.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z4.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z3.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z1.h, z1.h, z1.h
; CHECK-NEXT:    uzp1 z0.h, z2.h, z2.h
; CHECK-NEXT:    splice z2.h, p0, { z3.h, z4.h }
; CHECK-NEXT:    splice z0.h, p0, { z0.h, z1.h }
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z2.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z1.b, z0.b, z0.b
; CHECK-NEXT:    splice z0.b, p0, { z1.b, z2.b }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i64_v16i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #144
; NONEON-NOSVE-NEXT:    ldp q0, q1, [x0, #96]
; NONEON-NOSVE-NEXT:    ldp q2, q3, [x0]
; NONEON-NOSVE-NEXT:    ldp q4, q5, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q6, q7, [x0, #64]
; NONEON-NOSVE-NEXT:    stp q0, q1, [sp, #64]
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp, #80]
; NONEON-NOSVE-NEXT:    str q2, [sp, #128]
; NONEON-NOSVE-NEXT:    stp q3, q4, [sp, #32]
; NONEON-NOSVE-NEXT:    stp q7, q5, [sp]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #126]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp, #64]
; NONEON-NOSVE-NEXT:    str q6, [sp, #96]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #127]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #124]
; NONEON-NOSVE-NEXT:    ldp x8, x11, [sp]
; NONEON-NOSVE-NEXT:    strb w10, [sp, #125]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #122]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #104]
; NONEON-NOSVE-NEXT:    strb w11, [sp, #123]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #121]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #96]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #120]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #24]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #119]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #16]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #118]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #56]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #117]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #48]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #116]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #40]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #115]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #32]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #114]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #136]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #113]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #128]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #112]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #112]
; NONEON-NOSVE-NEXT:    add sp, sp, #144
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i64>, ptr %in
  %b = trunc <16 x i64> %a to <16 x i8>
  ret <16 x i8> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i64_v32i8(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i64_v32i8:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q5, q6, [x0, #224]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q2, q3, [x0, #32]
; CHECK-NEXT:    ldp q4, q7, [x0, #64]
; CHECK-NEXT:    uzp1 z17.s, z6.s, z6.s
; CHECK-NEXT:    ldp q6, q18, [x0, #192]
; CHECK-NEXT:    uzp1 z16.s, z5.s, z5.s
; CHECK-NEXT:    ldp q5, q19, [x0, #128]
; CHECK-NEXT:    ldp q0, q1, [x0]
; CHECK-NEXT:    uzp1 z21.s, z18.s, z18.s
; CHECK-NEXT:    ldp q18, q22, [x0, #160]
; CHECK-NEXT:    uzp1 z20.s, z6.s, z6.s
; CHECK-NEXT:    ldp q6, q23, [x0, #96]
; CHECK-NEXT:    splice z16.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    uzp1 z27.s, z19.s, z19.s
; CHECK-NEXT:    uzp1 z25.s, z22.s, z22.s
; CHECK-NEXT:    uzp1 z26.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z24.s, z18.s, z18.s
; CHECK-NEXT:    uzp1 z18.s, z23.s, z23.s
; CHECK-NEXT:    uzp1 z23.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z17.s, z6.s, z6.s
; CHECK-NEXT:    uzp1 z6.s, z7.s, z7.s
; CHECK-NEXT:    uzp1 z22.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z5.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z2.s, z1.s, z1.s
; CHECK-NEXT:    splice z3.s, p0, { z20.s, z21.s }
; CHECK-NEXT:    uzp1 z1.s, z0.s, z0.s
; CHECK-NEXT:    splice z0.s, p0, { z24.s, z25.s }
; CHECK-NEXT:    splice z7.s, p0, { z26.s, z27.s }
; CHECK-NEXT:    splice z4.s, p0, { z17.s, z18.s }
; CHECK-NEXT:    uzp1 z17.h, z16.h, z16.h
; CHECK-NEXT:    splice z5.s, p0, { z5.s, z6.s }
; CHECK-NEXT:    splice z6.s, p0, { z22.s, z23.s }
; CHECK-NEXT:    splice z1.s, p0, { z1.s, z2.s }
; CHECK-NEXT:    uzp1 z16.h, z3.h, z3.h
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z3.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z19.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z2.h, z7.h, z7.h
; CHECK-NEXT:    uzp1 z18.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z5.h, z6.h, z6.h
; CHECK-NEXT:    splice z0.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    uzp1 z4.h, z1.h, z1.h
; CHECK-NEXT:    splice z1.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    splice z2.h, p0, { z18.h, z19.h }
; CHECK-NEXT:    splice z3.h, p0, { z4.h, z5.h }
; CHECK-NEXT:    uzp1 z5.b, z0.b, z0.b
; CHECK-NEXT:    ptrue p0.b, vl8
; CHECK-NEXT:    uzp1 z4.b, z1.b, z1.b
; CHECK-NEXT:    uzp1 z7.b, z2.b, z2.b
; CHECK-NEXT:    uzp1 z6.b, z3.b, z3.b
; CHECK-NEXT:    splice z0.b, p0, { z4.b, z5.b }
; CHECK-NEXT:    splice z1.b, p0, { z6.b, z7.b }
; CHECK-NEXT:    add z0.b, z0.b, z0.b
; CHECK-NEXT:    add z1.b, z1.b, z1.b
; CHECK-NEXT:    stp q1, q0, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i64_v32i8:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #416
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #96]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #336] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #64]
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #352] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #368] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #384] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #128]
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #400] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0]
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #320] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #224]
; NONEON-NOSVE-NEXT:    str x1, [sp, #280] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #192]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #160]
; NONEON-NOSVE-NEXT:    stp q16, q17, [sp, #16]
; NONEON-NOSVE-NEXT:    stp q2, q4, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #16]
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #24]
; NONEON-NOSVE-NEXT:    stp q7, q21, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w25, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w26, [sp, #104]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #112]
; NONEON-NOSVE-NEXT:    ldr w19, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w20, [sp, #56]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #136]
; NONEON-NOSVE-NEXT:    stp q6, q5, [sp, #144]
; NONEON-NOSVE-NEXT:    ldr w23, [sp, #160]
; NONEON-NOSVE-NEXT:    ldr w21, [sp, #144]
; NONEON-NOSVE-NEXT:    ldr w24, [sp, #168]
; NONEON-NOSVE-NEXT:    add w5, w9, w9
; NONEON-NOSVE-NEXT:    add w6, w8, w8
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w22, [sp, #152]
; NONEON-NOSVE-NEXT:    stp q23, q22, [sp, #176]
; NONEON-NOSVE-NEXT:    str w8, [sp, #276] // 4-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88]
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #64]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    stp q19, q18, [sp, #208]
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #192]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    stp q20, q3, [sp, #288]
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #224]
; NONEON-NOSVE-NEXT:    ldr w27, [sp, #304]
; NONEON-NOSVE-NEXT:    ldr w28, [sp, #312]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #250]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #251]
; NONEON-NOSVE-NEXT:    ldr w2, [sp, #208]
; NONEON-NOSVE-NEXT:    ldr w18, [sp, #288]
; NONEON-NOSVE-NEXT:    add w9, w27, w27
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    ldr w7, [sp, #232]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #248]
; NONEON-NOSVE-NEXT:    add w9, w25, w25
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #216]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #246]
; NONEON-NOSVE-NEXT:    add w9, w23, w23
; NONEON-NOSVE-NEXT:    ldr w0, [sp, #296]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #249]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #176]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #244]
; NONEON-NOSVE-NEXT:    add w9, w21, w21
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #72]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #247]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #200]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #242]
; NONEON-NOSVE-NEXT:    add w9, w19, w19
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #184]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #245]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    ldr w1, [sp, #40]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #240]
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    ldr w29, [sp, #112]
; NONEON-NOSVE-NEXT:    strb w8, [sp, #243]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    ldr w30, [sp, #120]
; NONEON-NOSVE-NEXT:    strb w9, [sp, #270]
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    strb w8, [sp, #241]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    strb w9, [sp, #268]
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    strb w8, [sp, #271]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    strb w9, [sp, #266]
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    strb w8, [sp, #269]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strb w9, [sp, #264]
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    strb w8, [sp, #267]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strb w9, [sp, #262]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    strb w8, [sp, #265]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strb w9, [sp, #260]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    strb w8, [sp, #263]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    strb w9, [sp, #258]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #276] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #261]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strb w5, [sp, #255]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    strb w6, [sp, #254]
; NONEON-NOSVE-NEXT:    add w6, w29, w29
; NONEON-NOSVE-NEXT:    strb w8, [sp, #259]
; NONEON-NOSVE-NEXT:    add w8, w1, w1
; NONEON-NOSVE-NEXT:    strb w5, [sp, #253]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #400] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w6, [sp, #252]
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #384] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w8, [sp, #257]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #280] // 8-byte Folded Reload
; NONEON-NOSVE-NEXT:    strb w9, [sp, #256]
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #368] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #240]
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #352] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #336] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q1, q0, [x8]
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #320] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add sp, sp, #416
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i64>, ptr %in
  %b = trunc <32 x i64> %a to <32 x i8>
  %c = add <32 x i8> %b, %b
  store <32 x i8> %c, ptr %out
  ret void
}

;
; truncate i64 -> i16
;

define <4 x i16> @trunc_v4i64_v4i16(ptr %in) nounwind {
; CHECK-LABEL: trunc_v4i64_v4i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    uzp1 z3.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z2.s, z1.s, z1.s
; CHECK-NEXT:    splice z0.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    uzp1 z0.h, z0.h, z0.h
; CHECK-NEXT:    // kill: def $d0 killed $d0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v4i64_v4i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #48
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp, #32]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #12]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #14]
; NONEON-NOSVE-NEXT:    strh w10, [sp, #10]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #8]
; NONEON-NOSVE-NEXT:    ldr d0, [sp, #8]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <4 x i64>, ptr %in
  %b = trunc <4 x i64> %a to <4 x i16>
  ret <4 x i16> %b
}

define <8 x i16> @trunc_v8i64_v8i16(ptr %in) nounwind {
; CHECK-LABEL: trunc_v8i64_v8i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z4.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z1.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z0.s, z3.s, z3.s
; CHECK-NEXT:    splice z2.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    splice z0.s, p0, { z0.s, z1.s }
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z2.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z1.h, z0.h, z0.h
; CHECK-NEXT:    splice z0.h, p0, { z1.h, z2.h }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v8i64_v8i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q2, q3, [x0]
; NONEON-NOSVE-NEXT:    stp q0, q3, [sp, #-80]!
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp]
; NONEON-NOSVE-NEXT:    str q1, [sp, #32]
; NONEON-NOSVE-NEXT:    str q2, [sp, #64]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #60]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp, #32]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #62]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #56]
; NONEON-NOSVE-NEXT:    ldp x8, x11, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w10, [sp, #58]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #52]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #72]
; NONEON-NOSVE-NEXT:    strh w11, [sp, #54]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #50]
; NONEON-NOSVE-NEXT:    ldr x8, [sp, #64]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #48]
; NONEON-NOSVE-NEXT:    add sp, sp, #80
; NONEON-NOSVE-NEXT:    ret
  %a = load <8 x i64>, ptr %in
  %b = trunc <8 x i64> %a to <8 x i16>
  ret <8 x i16> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v16i64_v16i16(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v16i64_v16i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q0, q1, [x0, #96]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q2, q3, [x0, #32]
; CHECK-NEXT:    ldp q4, q5, [x0, #64]
; CHECK-NEXT:    ldp q6, q7, [x0]
; CHECK-NEXT:    uzp1 z17.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z16.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z1.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z19.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z0.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z3.s, z7.s, z7.s
; CHECK-NEXT:    uzp1 z18.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z2.s, z6.s, z6.s
; CHECK-NEXT:    splice z4.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    splice z0.s, p0, { z0.s, z1.s }
; CHECK-NEXT:    splice z5.s, p0, { z18.s, z19.s }
; CHECK-NEXT:    splice z1.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z3.h, z4.h, z4.h
; CHECK-NEXT:    uzp1 z7.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z2.h, z5.h, z5.h
; CHECK-NEXT:    uzp1 z6.h, z1.h, z1.h
; CHECK-NEXT:    splice z0.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    splice z1.h, p0, { z6.h, z7.h }
; CHECK-NEXT:    add z0.h, z0.h, z0.h
; CHECK-NEXT:    add z1.h, z1.h, z1.h
; CHECK-NEXT:    stp q1, q0, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i64_v16i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #160
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #96]
; NONEON-NOSVE-NEXT:    str q2, [sp, #48]
; NONEON-NOSVE-NEXT:    stp q4, q3, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #56]
; NONEON-NOSVE-NEXT:    ldr w2, [sp, #112]
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #120]
; NONEON-NOSVE-NEXT:    str q5, [sp]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w5, [sp, #104]
; NONEON-NOSVE-NEXT:    stp q7, q6, [sp, #64]
; NONEON-NOSVE-NEXT:    ldr w18, [sp]
; NONEON-NOSVE-NEXT:    ldr w0, [sp, #8]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #142]
; NONEON-NOSVE-NEXT:    add w9, w3, w3
; NONEON-NOSVE-NEXT:    strh w8, [sp, #140]
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #88]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #138]
; NONEON-NOSVE-NEXT:    add w9, w5, w5
; NONEON-NOSVE-NEXT:    strh w8, [sp, #136]
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #72]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #134]
; NONEON-NOSVE-NEXT:    add w9, w0, w0
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #32]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #132]
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #40]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #130]
; NONEON-NOSVE-NEXT:    add w9, w17, w17
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #128]
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #24]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #158]
; NONEON-NOSVE-NEXT:    add w9, w15, w15
; NONEON-NOSVE-NEXT:    strh w8, [sp, #156]
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    strh w9, [sp, #154]
; NONEON-NOSVE-NEXT:    add w9, w13, w13
; NONEON-NOSVE-NEXT:    strh w8, [sp, #152]
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    strh w9, [sp, #150]
; NONEON-NOSVE-NEXT:    add w9, w11, w11
; NONEON-NOSVE-NEXT:    strh w8, [sp, #148]
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    strh w9, [sp, #146]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #144]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #128]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    add sp, sp, #160
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i64>, ptr %in
  %b = trunc <16 x i64> %a to <16 x i16>
  %c = add <16 x i16> %b, %b
  store <16 x i16> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i64_v32i16(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i64_v32i16:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q2, q3, [x0, #160]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q4, q5, [x0, #96]
; CHECK-NEXT:    ldp q6, q7, [x0]
; CHECK-NEXT:    uzp1 z17.s, z3.s, z3.s
; CHECK-NEXT:    ldp q3, q18, [x0, #128]
; CHECK-NEXT:    uzp1 z16.s, z2.s, z2.s
; CHECK-NEXT:    ldp q2, q19, [x0, #192]
; CHECK-NEXT:    ldp q0, q1, [x0, #64]
; CHECK-NEXT:    uzp1 z21.s, z18.s, z18.s
; CHECK-NEXT:    ldp q18, q22, [x0, #224]
; CHECK-NEXT:    uzp1 z20.s, z3.s, z3.s
; CHECK-NEXT:    ldp q3, q23, [x0, #32]
; CHECK-NEXT:    splice z16.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    uzp1 z27.s, z19.s, z19.s
; CHECK-NEXT:    uzp1 z25.s, z22.s, z22.s
; CHECK-NEXT:    uzp1 z26.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z24.s, z18.s, z18.s
; CHECK-NEXT:    uzp1 z18.s, z23.s, z23.s
; CHECK-NEXT:    uzp1 z23.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z17.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z3.s, z7.s, z7.s
; CHECK-NEXT:    uzp1 z22.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z2.s, z6.s, z6.s
; CHECK-NEXT:    uzp1 z5.s, z1.s, z1.s
; CHECK-NEXT:    splice z1.s, p0, { z20.s, z21.s }
; CHECK-NEXT:    splice z6.s, p0, { z24.s, z25.s }
; CHECK-NEXT:    uzp1 z4.s, z0.s, z0.s
; CHECK-NEXT:    splice z0.s, p0, { z26.s, z27.s }
; CHECK-NEXT:    splice z7.s, p0, { z17.s, z18.s }
; CHECK-NEXT:    uzp1 z17.h, z16.h, z16.h
; CHECK-NEXT:    splice z2.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    splice z3.s, p0, { z22.s, z23.s }
; CHECK-NEXT:    splice z4.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    uzp1 z16.h, z1.h, z1.h
; CHECK-NEXT:    ptrue p0.h, vl4
; CHECK-NEXT:    uzp1 z6.h, z6.h, z6.h
; CHECK-NEXT:    uzp1 z5.h, z0.h, z0.h
; CHECK-NEXT:    uzp1 z1.h, z7.h, z7.h
; CHECK-NEXT:    uzp1 z0.h, z2.h, z2.h
; CHECK-NEXT:    uzp1 z3.h, z3.h, z3.h
; CHECK-NEXT:    splice z7.h, p0, { z16.h, z17.h }
; CHECK-NEXT:    uzp1 z2.h, z4.h, z4.h
; CHECK-NEXT:    splice z4.h, p0, { z5.h, z6.h }
; CHECK-NEXT:    splice z0.h, p0, { z0.h, z1.h }
; CHECK-NEXT:    splice z1.h, p0, { z2.h, z3.h }
; CHECK-NEXT:    add z2.h, z7.h, z7.h
; CHECK-NEXT:    add z3.h, z4.h, z4.h
; CHECK-NEXT:    add z0.h, z0.h, z0.h
; CHECK-NEXT:    add z1.h, z1.h, z1.h
; CHECK-NEXT:    stp q2, q3, [x1, #32]
; CHECK-NEXT:    stp q0, q1, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i64_v32i16:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #448
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #96]
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #368] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #128]
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #384] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #400] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #64]
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #416] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #32]
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #432] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0]
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #352] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #224]
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #192]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #160]
; NONEON-NOSVE-NEXT:    stp q16, q17, [sp, #16]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #24]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #112]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #120]
; NONEON-NOSVE-NEXT:    stp q7, q21, [sp, #48]
; NONEON-NOSVE-NEXT:    stp q2, q4, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w19, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w20, [sp, #56]
; NONEON-NOSVE-NEXT:    add w6, w8, w8
; NONEON-NOSVE-NEXT:    add w5, w9, w9
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #40]
; NONEON-NOSVE-NEXT:    stp q20, q3, [sp, #320]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w25, [sp, #144]
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #88] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #136]
; NONEON-NOSVE-NEXT:    ldr w27, [sp, #336]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    ldr w28, [sp, #344]
; NONEON-NOSVE-NEXT:    stp q6, q5, [sp, #176]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldr w26, [sp, #152]
; NONEON-NOSVE-NEXT:    ldr w23, [sp, #192]
; NONEON-NOSVE-NEXT:    ldr w24, [sp, #200]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #310]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    strh w9, [sp, #308]
; NONEON-NOSVE-NEXT:    add w9, w27, w27
; NONEON-NOSVE-NEXT:    ldr w21, [sp, #176]
; NONEON-NOSVE-NEXT:    ldr w22, [sp, #184]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #306]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    strh w9, [sp, #304]
; NONEON-NOSVE-NEXT:    add w9, w25, w25
; NONEON-NOSVE-NEXT:    ldr w18, [sp, #320]
; NONEON-NOSVE-NEXT:    stp q23, q22, [sp, #208]
; NONEON-NOSVE-NEXT:    ldr w0, [sp, #328]
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q19, q18, [sp, #240]
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #72]
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #224]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #302]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #256]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #300]
; NONEON-NOSVE-NEXT:    add w9, w23, w23
; NONEON-NOSVE-NEXT:    ldr w7, [sp, #264]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #298]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    ldr w2, [sp, #240]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #296]
; NONEON-NOSVE-NEXT:    add w9, w21, w21
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #248]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #294]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #232]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #292]
; NONEON-NOSVE-NEXT:    add w9, w19, w19
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #208]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #290]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #216]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #288]
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #16]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #174]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    ldr w29, [sp, #96]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #172]
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    ldr w30, [sp, #104]
; NONEON-NOSVE-NEXT:    strh w8, [sp, #170]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    strh w9, [sp, #168]
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    strh w8, [sp, #166]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    strh w9, [sp, #164]
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    strh w8, [sp, #162]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    strh w9, [sp, #160]
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    strh w8, [sp, #286]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    ldr q1, [sp, #160]
; NONEON-NOSVE-NEXT:    strh w9, [sp, #284]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    strh w8, [sp, #282]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    strh w9, [sp, #280]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    strh w8, [sp, #278]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #88] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w9, [sp, #276]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #92] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    strh w5, [sp, #318]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    strh w6, [sp, #316]
; NONEON-NOSVE-NEXT:    add w6, w29, w29
; NONEON-NOSVE-NEXT:    strh w8, [sp, #274]
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #432] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w9, [sp, #272]
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #416] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    strh w5, [sp, #314]
; NONEON-NOSVE-NEXT:    ldp q0, q3, [sp, #272]
; NONEON-NOSVE-NEXT:    strh w6, [sp, #312]
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #400] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldr q2, [sp, #304]
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #384] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q0, q1, [x1, #32]
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #368] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    stp q3, q2, [x1]
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp, #352] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    add sp, sp, #448
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i64>, ptr %in
  %b = trunc <32 x i64> %a to <32 x i16>
  %c = add <32 x i16> %b, %b
  store <32 x i16> %c, ptr %out
  ret void
}

;
; truncate i64 -> i32
;

define <4 x i32> @trunc_v4i64_v4i32(ptr %in) nounwind {
; CHECK-LABEL: trunc_v4i64_v4i32:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    uzp1 z3.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z2.s, z1.s, z1.s
; CHECK-NEXT:    splice z0.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    // kill: def $q0 killed $q0 killed $z0
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v4i64_v4i32:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0]
; NONEON-NOSVE-NEXT:    stp q1, q0, [sp, #-48]!
; NONEON-NOSVE-NEXT:    ldp x8, x9, [sp, #16]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #40]
; NONEON-NOSVE-NEXT:    ldp x8, x10, [sp]
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr q0, [sp, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #48
; NONEON-NOSVE-NEXT:    ret
  %a = load <4 x i64>, ptr %in
  %b = trunc <4 x i64> %a to <4 x i32>
  ret <4 x i32> %b
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v8i64_v8i32(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v8i64_v8i32:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q3, q2, [x0]
; CHECK-NEXT:    uzp1 z5.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z4.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z1.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z0.s, z3.s, z3.s
; CHECK-NEXT:    splice z2.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    splice z0.s, p0, { z0.s, z1.s }
; CHECK-NEXT:    add z1.s, z2.s, z2.s
; CHECK-NEXT:    add z0.s, z0.s, z0.s
; CHECK-NEXT:    stp q0, q1, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v8i64_v8i32:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #96
; NONEON-NOSVE-NEXT:    ldp q0, q1, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    stp q3, q1, [sp]
; NONEON-NOSVE-NEXT:    stp q2, q0, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr w12, [sp]
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #8]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #40]
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #16]
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #24]
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #56]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #72]
; NONEON-NOSVE-NEXT:    add w9, w13, w13
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #64]
; NONEON-NOSVE-NEXT:    add w9, w15, w15
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #88]
; NONEON-NOSVE-NEXT:    add w9, w11, w11
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #80]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    add sp, sp, #96
; NONEON-NOSVE-NEXT:    ret
  %a = load <8 x i64>, ptr %in
  %b = trunc <8 x i64> %a to <8 x i32>
  %c = add <8 x i32> %b, %b
  store <8 x i32> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v16i64_v16i32(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v16i64_v16i32:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q1, q0, [x0, #64]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q2, q3, [x0, #96]
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    uzp1 z7.s, z0.s, z0.s
; CHECK-NEXT:    uzp1 z6.s, z1.s, z1.s
; CHECK-NEXT:    ldp q1, q0, [x0, #32]
; CHECK-NEXT:    uzp1 z17.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z16.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z3.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z2.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z5.s, z0.s, z0.s
; CHECK-NEXT:    splice z0.s, p0, { z6.s, z7.s }
; CHECK-NEXT:    uzp1 z4.s, z1.s, z1.s
; CHECK-NEXT:    splice z1.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    splice z2.s, p0, { z2.s, z3.s }
; CHECK-NEXT:    splice z3.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    add z0.s, z0.s, z0.s
; CHECK-NEXT:    add z1.s, z1.s, z1.s
; CHECK-NEXT:    add z2.s, z2.s, z2.s
; CHECK-NEXT:    add z3.s, z3.s, z3.s
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v16i64_v16i32:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    sub sp, sp, #192
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #96]
; NONEON-NOSVE-NEXT:    stp q0, q2, [sp, #64]
; NONEON-NOSVE-NEXT:    stp q5, q1, [sp]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #88]
; NONEON-NOSVE-NEXT:    stp q4, q3, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w18, [sp]
; NONEON-NOSVE-NEXT:    ldr w0, [sp, #8]
; NONEON-NOSVE-NEXT:    ldr w2, [sp, #112]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #120]
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w5, [sp, #104]
; NONEON-NOSVE-NEXT:    stp q7, q6, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #64]
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #72]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #184]
; NONEON-NOSVE-NEXT:    add w9, w3, w3
; NONEON-NOSVE-NEXT:    add w8, w2, w2
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #144]
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #152]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #176]
; NONEON-NOSVE-NEXT:    add w9, w5, w5
; NONEON-NOSVE-NEXT:    add w8, w4, w4
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #128]
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #136]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #168]
; NONEON-NOSVE-NEXT:    add w9, w0, w0
; NONEON-NOSVE-NEXT:    add w8, w18, w18
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #16]
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #24]
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #160]
; NONEON-NOSVE-NEXT:    add w9, w17, w17
; NONEON-NOSVE-NEXT:    add w8, w16, w16
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #40]
; NONEON-NOSVE-NEXT:    add w9, w15, w15
; NONEON-NOSVE-NEXT:    add w8, w14, w14
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #32]
; NONEON-NOSVE-NEXT:    add w9, w13, w13
; NONEON-NOSVE-NEXT:    add w8, w12, w12
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #56]
; NONEON-NOSVE-NEXT:    add w9, w11, w11
; NONEON-NOSVE-NEXT:    add w8, w10, w10
; NONEON-NOSVE-NEXT:    stp w8, w9, [sp, #48]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [sp, #160]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #32]
; NONEON-NOSVE-NEXT:    stp q3, q2, [x1]
; NONEON-NOSVE-NEXT:    stp q0, q1, [x1, #32]
; NONEON-NOSVE-NEXT:    add sp, sp, #192
; NONEON-NOSVE-NEXT:    ret
  %a = load <16 x i64>, ptr %in
  %b = trunc <16 x i64> %a to <16 x i32>
  %c = add <16 x i32> %b, %b
  store <16 x i32> %c, ptr %out
  ret void
}

; NOTE: Extra 'add' is to prevent the truncate being combined with the store.
define void @trunc_v32i64_v32i32(ptr %in, ptr %out) nounwind {
; CHECK-LABEL: trunc_v32i64_v32i32:
; CHECK:       // %bb.0:
; CHECK-NEXT:    ldp q2, q3, [x0, #192]
; CHECK-NEXT:    ptrue p0.s, vl2
; CHECK-NEXT:    ldp q4, q5, [x0]
; CHECK-NEXT:    ldp q6, q7, [x0, #64]
; CHECK-NEXT:    uzp1 z17.s, z3.s, z3.s
; CHECK-NEXT:    ldp q3, q18, [x0, #224]
; CHECK-NEXT:    uzp1 z16.s, z2.s, z2.s
; CHECK-NEXT:    ldp q2, q19, [x0, #128]
; CHECK-NEXT:    ldp q0, q1, [x0, #32]
; CHECK-NEXT:    uzp1 z21.s, z18.s, z18.s
; CHECK-NEXT:    ldp q18, q22, [x0, #160]
; CHECK-NEXT:    uzp1 z20.s, z3.s, z3.s
; CHECK-NEXT:    uzp1 z24.s, z19.s, z19.s
; CHECK-NEXT:    ldp q3, q19, [x0, #96]
; CHECK-NEXT:    uzp1 z23.s, z2.s, z2.s
; CHECK-NEXT:    uzp1 z26.s, z22.s, z22.s
; CHECK-NEXT:    splice z2.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    uzp1 z17.s, z7.s, z7.s
; CHECK-NEXT:    uzp1 z25.s, z18.s, z18.s
; CHECK-NEXT:    splice z7.s, p0, { z20.s, z21.s }
; CHECK-NEXT:    uzp1 z21.s, z5.s, z5.s
; CHECK-NEXT:    uzp1 z19.s, z19.s, z19.s
; CHECK-NEXT:    uzp1 z20.s, z4.s, z4.s
; CHECK-NEXT:    uzp1 z5.s, z1.s, z1.s
; CHECK-NEXT:    uzp1 z16.s, z6.s, z6.s
; CHECK-NEXT:    splice z6.s, p0, { z23.s, z24.s }
; CHECK-NEXT:    uzp1 z18.s, z3.s, z3.s
; CHECK-NEXT:    splice z3.s, p0, { z25.s, z26.s }
; CHECK-NEXT:    uzp1 z4.s, z0.s, z0.s
; CHECK-NEXT:    add z0.s, z2.s, z2.s
; CHECK-NEXT:    add z7.s, z7.s, z7.s
; CHECK-NEXT:    splice z1.s, p0, { z16.s, z17.s }
; CHECK-NEXT:    splice z2.s, p0, { z18.s, z19.s }
; CHECK-NEXT:    splice z16.s, p0, { z20.s, z21.s }
; CHECK-NEXT:    splice z4.s, p0, { z4.s, z5.s }
; CHECK-NEXT:    add z6.s, z6.s, z6.s
; CHECK-NEXT:    add z3.s, z3.s, z3.s
; CHECK-NEXT:    stp q0, q7, [x1, #96]
; CHECK-NEXT:    add z0.s, z1.s, z1.s
; CHECK-NEXT:    add z1.s, z2.s, z2.s
; CHECK-NEXT:    add z2.s, z16.s, z16.s
; CHECK-NEXT:    stp q6, q3, [x1, #64]
; CHECK-NEXT:    add z3.s, z4.s, z4.s
; CHECK-NEXT:    stp q0, q1, [x1, #32]
; CHECK-NEXT:    stp q2, q3, [x1]
; CHECK-NEXT:    ret
;
; NONEON-NOSVE-LABEL: trunc_v32i64_v32i32:
; NONEON-NOSVE:       // %bb.0:
; NONEON-NOSVE-NEXT:    stp x29, x30, [sp, #-96]! // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x28, x27, [sp, #16] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x26, x25, [sp, #32] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x24, x23, [sp, #48] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x22, x21, [sp, #64] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    stp x20, x19, [sp, #80] // 16-byte Folded Spill
; NONEON-NOSVE-NEXT:    sub sp, sp, #416
; NONEON-NOSVE-NEXT:    ldp q1, q0, [x0, #32]
; NONEON-NOSVE-NEXT:    ldp q7, q6, [x0, #64]
; NONEON-NOSVE-NEXT:    ldp q17, q16, [x0, #192]
; NONEON-NOSVE-NEXT:    ldp q3, q2, [x0]
; NONEON-NOSVE-NEXT:    ldp q5, q4, [x0, #96]
; NONEON-NOSVE-NEXT:    ldp q19, q18, [x0, #160]
; NONEON-NOSVE-NEXT:    ldp q21, q20, [x0, #128]
; NONEON-NOSVE-NEXT:    ldp q23, q22, [x0, #224]
; NONEON-NOSVE-NEXT:    stp q6, q0, [sp, #16]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #32]
; NONEON-NOSVE-NEXT:    stp q17, q16, [sp, #48]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #40]
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #48]
; NONEON-NOSVE-NEXT:    stp q7, q21, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w21, [sp, #16]
; NONEON-NOSVE-NEXT:    add w6, w8, w8
; NONEON-NOSVE-NEXT:    add w5, w9, w9
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #56]
; NONEON-NOSVE-NEXT:    stp q2, q1, [sp, #192]
; NONEON-NOSVE-NEXT:    ldr w22, [sp, #24]
; NONEON-NOSVE-NEXT:    ldr w19, [sp, #80]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #192]
; NONEON-NOSVE-NEXT:    stp q5, q4, [sp, #224]
; NONEON-NOSVE-NEXT:    ldr w20, [sp, #88]
; NONEON-NOSVE-NEXT:    stp q3, q20, [sp, #384]
; NONEON-NOSVE-NEXT:    ldr w25, [sp, #240]
; NONEON-NOSVE-NEXT:    ldr w26, [sp, #248]
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    stp w8, w10, [sp, #120] // 8-byte Folded Spill
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #200]
; NONEON-NOSVE-NEXT:    ldr w27, [sp, #384]
; NONEON-NOSVE-NEXT:    ldr w28, [sp, #392]
; NONEON-NOSVE-NEXT:    ldr w23, [sp, #224]
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    ldr w24, [sp, #232]
; NONEON-NOSVE-NEXT:    str w9, [sp, #360]
; NONEON-NOSVE-NEXT:    add w9, w27, w27
; NONEON-NOSVE-NEXT:    str w8, [sp, #364]
; NONEON-NOSVE-NEXT:    add w8, w28, w28
; NONEON-NOSVE-NEXT:    str w8, [sp, #356]
; NONEON-NOSVE-NEXT:    add w8, w26, w26
; NONEON-NOSVE-NEXT:    ldr w18, [sp, #400]
; NONEON-NOSVE-NEXT:    str w9, [sp, #352]
; NONEON-NOSVE-NEXT:    add w9, w25, w25
; NONEON-NOSVE-NEXT:    ldr w0, [sp, #408]
; NONEON-NOSVE-NEXT:    stp q19, q18, [sp, #256]
; NONEON-NOSVE-NEXT:    ldr w16, [sp, #96]
; NONEON-NOSVE-NEXT:    ldr w17, [sp, #104]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #136]
; NONEON-NOSVE-NEXT:    add w8, w24, w24
; NONEON-NOSVE-NEXT:    add w9, w23, w23
; NONEON-NOSVE-NEXT:    ldr w4, [sp, #272]
; NONEON-NOSVE-NEXT:    ldr w7, [sp, #280]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #128]
; NONEON-NOSVE-NEXT:    add w8, w22, w22
; NONEON-NOSVE-NEXT:    add w9, w21, w21
; NONEON-NOSVE-NEXT:    ldr w2, [sp, #256]
; NONEON-NOSVE-NEXT:    ldr w3, [sp, #264]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #152]
; NONEON-NOSVE-NEXT:    add w8, w20, w20
; NONEON-NOSVE-NEXT:    add w9, w19, w19
; NONEON-NOSVE-NEXT:    stp q23, q22, [sp, #288]
; NONEON-NOSVE-NEXT:    ldr w10, [sp, #64]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #144]
; NONEON-NOSVE-NEXT:    add w8, w7, w7
; NONEON-NOSVE-NEXT:    add w9, w4, w4
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #168]
; NONEON-NOSVE-NEXT:    add w8, w3, w3
; NONEON-NOSVE-NEXT:    add w9, w2, w2
; NONEON-NOSVE-NEXT:    ldr w14, [sp, #304]
; NONEON-NOSVE-NEXT:    ldr w15, [sp, #312]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #160]
; NONEON-NOSVE-NEXT:    add w8, w0, w0
; NONEON-NOSVE-NEXT:    add w9, w18, w18
; NONEON-NOSVE-NEXT:    ldr w12, [sp, #288]
; NONEON-NOSVE-NEXT:    ldr w13, [sp, #296]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #184]
; NONEON-NOSVE-NEXT:    add w8, w17, w17
; NONEON-NOSVE-NEXT:    add w9, w16, w16
; NONEON-NOSVE-NEXT:    ldr w11, [sp, #72]
; NONEON-NOSVE-NEXT:    ldr w29, [sp, #208]
; NONEON-NOSVE-NEXT:    stp w9, w8, [sp, #176]
; NONEON-NOSVE-NEXT:    add w8, w15, w15
; NONEON-NOSVE-NEXT:    add w9, w14, w14
; NONEON-NOSVE-NEXT:    str w8, [sp, #332]
; NONEON-NOSVE-NEXT:    add w8, w13, w13
; NONEON-NOSVE-NEXT:    ldr w30, [sp, #216]
; NONEON-NOSVE-NEXT:    str w9, [sp, #328]
; NONEON-NOSVE-NEXT:    add w9, w12, w12
; NONEON-NOSVE-NEXT:    str w8, [sp, #324]
; NONEON-NOSVE-NEXT:    add w8, w11, w11
; NONEON-NOSVE-NEXT:    str w9, [sp, #320]
; NONEON-NOSVE-NEXT:    add w9, w10, w10
; NONEON-NOSVE-NEXT:    str w8, [sp, #348]
; NONEON-NOSVE-NEXT:    ldr w8, [sp, #120] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    str w9, [sp, #344]
; NONEON-NOSVE-NEXT:    ldr w9, [sp, #124] // 4-byte Folded Reload
; NONEON-NOSVE-NEXT:    str w5, [sp, #380]
; NONEON-NOSVE-NEXT:    add w5, w30, w30
; NONEON-NOSVE-NEXT:    add w8, w8, w8
; NONEON-NOSVE-NEXT:    str w6, [sp, #376]
; NONEON-NOSVE-NEXT:    add w6, w29, w29
; NONEON-NOSVE-NEXT:    add w9, w9, w9
; NONEON-NOSVE-NEXT:    str w5, [sp, #372]
; NONEON-NOSVE-NEXT:    ldp q3, q4, [sp, #128]
; NONEON-NOSVE-NEXT:    str w6, [sp, #368]
; NONEON-NOSVE-NEXT:    ldp q6, q7, [sp, #160]
; NONEON-NOSVE-NEXT:    str w8, [sp, #340]
; NONEON-NOSVE-NEXT:    ldp q1, q0, [sp, #352]
; NONEON-NOSVE-NEXT:    str w9, [sp, #336]
; NONEON-NOSVE-NEXT:    ldp q5, q2, [sp, #320]
; NONEON-NOSVE-NEXT:    stp q4, q3, [x1, #32]
; NONEON-NOSVE-NEXT:    stp q1, q0, [x1]
; NONEON-NOSVE-NEXT:    stp q7, q6, [x1, #64]
; NONEON-NOSVE-NEXT:    stp q2, q5, [x1, #96]
; NONEON-NOSVE-NEXT:    add sp, sp, #416
; NONEON-NOSVE-NEXT:    ldp x20, x19, [sp, #80] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x22, x21, [sp, #64] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x24, x23, [sp, #48] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x26, x25, [sp, #32] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x28, x27, [sp, #16] // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ldp x29, x30, [sp], #96 // 16-byte Folded Reload
; NONEON-NOSVE-NEXT:    ret
  %a = load <32 x i64>, ptr %in
  %b = trunc <32 x i64> %a to <32 x i32>
  %c = add <32 x i32> %b, %b
  store <32 x i32> %c, ptr %out
  ret void
}
