; NOTE: Assertions have been autogenerated by utils/update_test_checks.py UTC_ARGS: --version 5
; RUN: opt -S -passes=amdgpu-unify-divergent-exit-nodes -mtriple=amdgcn-amd-amdhsa -mcpu=gfx90a %s -o - | FileCheck %s

define void @spill_sgpr_with_tail_call() {
; CHECK-LABEL: define void @spill_sgpr_with_tail_call(
; CHECK-SAME: ) #[[ATTR0:[0-9]+]] {
; CHECK-NEXT:    [[L1:%.*]] = load i1, ptr null, align 1
; CHECK-NEXT:    br i1 [[L1]], label %[[SW_C:.*]], label %[[SW_D:.*]]
; CHECK:       [[SW_D]]:
; CHECK-NEXT:    musttail call void null()
; CHECK-NEXT:    ret void
; CHECK:       [[SW_C]]:
; CHECK-NEXT:    ret void
;
  %L1 = load i1, ptr null, align 1
  br i1 %L1, label %SW_C, label %SW_D

SW_D:
  musttail call void null()
  ret void

SW_C:
  ret void
}

